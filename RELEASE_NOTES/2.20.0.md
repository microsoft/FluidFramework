<!-- THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. -->

# Fluid Framework v2.20.0

## Contents

- [üêõ Bug Fixes](#-bug-fixes)
  - [Fix 'Error: PR-008: Trying to remove a non-existing entry' error in IndexedCollection class (#23243)](#fix-error-pr-008-trying-to-remove-a-non-existing-entry-error-in-indexedcollection-class-23243)
- [‚ö†Ô∏è Deprecations](#Ô∏è-deprecations)
  - [Events-related interfaces have been moved to core-interfaces (#23313)](#events-related-interfaces-have-been-moved-to-core-interfaces-23313)
- [Legacy API Changes](#legacy-api-changes)
  - [The MockLogger class has been removed (#23010)](#the-mocklogger-class-has-been-removed-23010)
  - [Previously deprecated Merge-Tree and SharedString ISegment members have been removed (#23448)](#previously-deprecated-merge-tree-and-sharedstring-isegment-members-have-been-removed-23448)
  - [The IContainerRuntimeOptions.flushMode property has been removed (#23337)](#the-icontainerruntimeoptionsflushmode-property-has-been-removed-23337)
  - [The ContainerRuntime class has been removed (#23341)](#the-containerruntime-class-has-been-removed-23341)
  - [The createDataStoreWithProps APIs on ContainerRuntime and IContainerRuntimeBase have been removed (#22996)](#the-createdatastorewithprops-apis-on-containerruntime-and-icontainerruntimebase-have-been-removed-22996)
  - [Replace 'any' in return type for several APIs (#23238)](#replace-any-in-return-type-for-several-apis-23238)
  - [Summarizer-related types have been moved to container-runtime-definitions (#23483)](#summarizer-related-types-have-been-moved-to-container-runtime-definitions-23483)
  - [Enabling Op Compression without Op Grouping is no longer supported (#23608)](#enabling-op-compression-without-op-grouping-is-no-longer-supported-23608)

## üêõ Bug Fixes

### Fix 'Error: PR-008: Trying to remove a non-existing entry' error in IndexedCollection class ([#23243](https://github.com/microsoft/FluidFramework/issues/23243))

The `IndexedCollection` class would throw the following error when applying a changeset:

```
Error: PR-008: Trying to remove a non-existing entry:
```

The underlying problem has been fixed and this error should no longer occur.

_Thanks to [@neerajcharokar](https://github.com/neerajcharokar) for submitting this fix!_

#### Change details

Commit: [`5996be1`](https://github.com/microsoft/FluidFramework/commit/5996be14364a1193e20ed9583de493cbfe6d8669)

Affected packages:

- @fluid-experimental/property-changeset

[‚¨ÜÔ∏è Table of contents](#contents)

## ‚ö†Ô∏è Deprecations

### Events-related interfaces have been moved to core-interfaces ([#23313](https://github.com/microsoft/FluidFramework/issues/23313))

The following interfaces and types have been moved from the `@fluidframework/tree` package into the `@fluidframework/core-interfaces` package. As such, they are now deprecated in the `@fluidframework/tree` package.

- Listeners
- IsListener
- Listenable
- Off

Users should now import them from either `@fluidframework/core-interfaces` or `fluid-framework`.

These deprecated interfaces will be removed from the `@fluidframework/tree` package in Fluid Framework v3.0.

#### Change details

Commit: [`69a755e`](https://github.com/microsoft/FluidFramework/commit/69a755ebd76db36ffd4638d331062f96ec4c0648)

Affected packages:

- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

## Legacy API Changes

### The MockLogger class has been removed ([#23010](https://github.com/microsoft/FluidFramework/issues/23010))

The `MockLogger` class, which was previously part of the alpha+legacy API in `@fluidframework/telemetry-utils`, has been removed. No replacement is provided. This class was only intended for use in testing scenarios and should be trivial to re-implement in any codebase that still needs it.

#### Change details

Commit: [`32ff6b9`](https://github.com/microsoft/FluidFramework/commit/32ff6b9c34be15636adc316a6c76e1755749e06e)

Affected packages:

- @fluidframework/telemetry-utils

[‚¨ÜÔ∏è Table of contents](#contents)

### Previously deprecated Merge-Tree and SharedString ISegment members have been removed ([#23448](https://github.com/microsoft/FluidFramework/issues/23448))

The current `ISegment` interface over-exposes a number of properties which do not have an external use case, and any external usage could result in damage to the underlying merge-tree including data corruption. [In Fluid Framework release 2.12.0 these properties and associated types were deprecated.](https://github.com/microsoft/FluidFramework/releases/tag/client_v2.12.0#user-content-merge-tree-and-sharedstring-isegment-deprecations-23323)

The only use case that will continue to be supported is determining if a segment is removed. For this purpose we've added the free function `segmentIsRemoved(segment: ISegment): boolean`.

For example, checking if a segment is not removed would change as follows:

```diff
- if(segment.removedSeq === undefined){
+ if(!segmentIsRemoved(segment)){
```

The following properties are removed from `ISegment` and its implementations:

- clientId
- index
- localMovedSeq
- localRefs
- localRemovedSeq
- localSeq
- movedClientsIds
- movedSeq
- movedSeqs
- ordinal
- removedClientIds
- removedSeq
- seq
- wasMovedOnInsert

Additionally, the following types are also removed:

- IMergeNodeCommon
- IMoveInfo
- IRemovalInfo
- LocalReferenceCollection

#### Change details

Commit: [`e98574f`](https://github.com/microsoft/FluidFramework/commit/e98574fc625bea7ebce6d79284f32556aaec1c50)

Affected packages:

- @fluidframework/merge-tree
- @fluidframework/sequence

[‚¨ÜÔ∏è Table of contents](#contents)

### The IContainerRuntimeOptions.flushMode property has been removed ([#23337](https://github.com/microsoft/FluidFramework/issues/23337))

The `IContainerRuntimeOptions.flushMode` property was [deprecated in version 2.12.0](https://github.com/microsoft/FluidFramework/releases/tag/client_v2.12.0#user-content-icontainerruntimeoptionsflushmode-is-now-deprecated-23288) and has been removed.

Only the default value, `FlushMode.TurnBased`, is supported when calling `ContainerRuntime.loadRuntime` directly, so there's no need for consumers to pass this option in.

#### Change details

Commit: [`fe8279c`](https://github.com/microsoft/FluidFramework/commit/fe8279c774fcc3c4805b49ce4f64d0e03a64c39b)

Affected packages:

- @fluidframework/container-runtime

[‚¨ÜÔ∏è Table of contents](#contents)

### The ContainerRuntime class has been removed ([#23341](https://github.com/microsoft/FluidFramework/issues/23341))

The `ContainerRuntime` class was [deprecated in version 2.12.0](https://github.com/microsoft/FluidFramework/releases/tag/client_v2.12.0#user-content-the-containerruntime-class-is-now-deprecated-23331) and has been removed. Use `IContainerRuntime` to replace type usages and use the free function `loadContainerRuntime` to replace usages of the static method `ContainerRuntime.loadRuntime`.

See the [deprecation announcement](https://github.com/microsoft/FluidFramework/releases/tag/client_v2.12.0#user-content-the-containerruntime-class-is-now-deprecated-23331) for more details about how to update existing code.

#### Change details

Commit: [`61ba06a`](https://github.com/microsoft/FluidFramework/commit/61ba06aa9881c30ffeeedcaaede9c5a1a0c81abd)

Affected packages:

- @fluidframework/aqueduct
- @fluid-experimental/attributor
- @fluidframework/container-runtime
- @fluidframework/test-utils

[‚¨ÜÔ∏è Table of contents](#contents)

### The createDataStoreWithProps APIs on ContainerRuntime and IContainerRuntimeBase have been removed ([#22996](https://github.com/microsoft/FluidFramework/issues/22996))

`ContainerRuntime.createDataStoreWithProps` and `IContainerRuntimeBase.createDataStoreWithProps` were [deprecated in version 0.25.0](https://github.com/microsoft/FluidFramework/blob/main/BREAKING.md#icontainerruntimebase_createdatastorewithprops-is-removed) and have been removed.

Replace uses of these APIs with `PureDataObjectFactory.createInstanceWithDataStore` and pass in props via the `initialState` parameter.

These changes were originally announced in version 0.25.0. See the following issues for more details:

- [#1537](https://github.com/microsoft/FluidFramework/issues/1537)
- [#2931](https://github.com/microsoft/FluidFramework/pull/2931)

#### Change details

Commit: [`bd243fb`](https://github.com/microsoft/FluidFramework/commit/bd243fb2927915d87c42486e21ee0c990962a9a7)

Affected packages:

- @fluidframework/aqueduct
- @fluidframework/container-runtime
- @fluidframework/container-runtime-definitions
- @fluidframework/datastore
- @fluidframework/runtime-definitions
- @fluidframework/test-runtime-utils

[‚¨ÜÔ∏è Table of contents](#contents)

### Replace 'any' in return type for several APIs ([#23238](https://github.com/microsoft/FluidFramework/issues/23238))

To improve type safety of the Fluid Framework legacy+alpha API surface, we're moving away from using the `any` type in favor of `unknown`.

We expect that any changes required in consumers of these APIs will be limited to having to provide explicit types when calling any of the APIs whose return value changed to `unknown`, like `IFluidSerializer.parse()`.

In summary, code that looked like this:

```typescript
// 'myVariable' ended up typed as 'any' here and TypeScript would not do any type-safety checks on it.
const myVariable = this.serializer.parse(stringHeader);
```

Will now have to look like this:

```typescript
// Do this if you know the type of the object you expect to get back.
const myVariable = this.serializer.parse(stringHeader) as MyType;

// Alternatively, this will maintain current behavior but also means no type-safety checks will be done by TS.
// const myVariable = this.serializer.parse(stringHeader) as any;
```

The appropriate type will depend on what the calling code is doing and the objects it expects to be dealing with.

We further encourage consumers of any of these APIs to add runtime checks to validate that the returned object actually matches the expected type.

The list of affected APIs is as follows:

- `IFluidSerializer.encode(...)` now takes `value: unknown` instead of `value: any` and returns `unknown` instead of `any`.
- `IFluidSerializer.decode(...)` now takes `input: unknown` instead of `input: any` and returns `unknown` instead of `any`.
- `IFluidSerializer.stringify(...)` now takes `value: unknown` instead of `value: any`.
- `IFluidSerializer.parse(...)` now returns `unknown` instead of `any`.
- `SharedObjectCore.applyStashedOps(...)` now takes `content: unknown` instead of `content: any`.
- `SharedObjectCore.rollback(...)` now takes `content: unknown` instead of `content: any`.
- `SharedObjectCore.submitLocalMessage(...)` now takes `content: unknown` instead of `content: any`.
- `SharedObjectCore.reSubmitCore(...)` now takes `content: unknown` instead of `content: any`.
- In `SharedObjectCore.newAckBasedPromise<T>(...)` the `executor` parameter now takes `reject: (reason?: unknown)` instead of `reject: (reason?: any)`.
- `makeHandlesSerializable(...)` now returns `unknown` instead of `any`.
- `parseHandles(...)` now returns `unknown` instead of `any`.

Additionally, the following APIs were never designed to return a value and have thus been updated to return `void` instead of `any`:

- `SharedObjectCore.processCore(...)`.
- `SharedObjectCore.onDisconnect(...)`

#### Change details

Commit: [`0783a31`](https://github.com/microsoft/FluidFramework/commit/0783a317317647e8881ec717a6f85c531cdbc956)

Affected packages:

- @fluidframework/shared-object-base

[‚¨ÜÔ∏è Table of contents](#contents)

### Summarizer-related types have been moved to container-runtime-definitions ([#23483](https://github.com/microsoft/FluidFramework/issues/23483))

`SummarizerStopReason`, `ISummarizeEventProps`, and `ISummarizerEvents` have all been moved from the `"@fluidframework/container-runtime"` package to `@fluidframework/container-runtime-definitions`.

Users should now import them from `@fluidframework/container-runtime-definitions`.

#### Change details

Commit: [`6666d49`](https://github.com/microsoft/FluidFramework/commit/6666d496e63031026cdedee98c24bb59fa79edcf)

Affected packages:

- @fluidframework/container-runtime

[‚¨ÜÔ∏è Table of contents](#contents)

### Enabling Op Compression without Op Grouping is no longer supported ([#23608](https://github.com/microsoft/FluidFramework/issues/23608))

`IContainerRuntimeOptions.enableGroupedBatching` was deprecated in 2.12 (see [release notes](https://github.com/microsoft/FluidFramework/releases/tag/client_v2.12.0#user-content-icontainerruntimeoptionsenablegroupedbatching-is-now-deprecated-23260)). While this option is not yet removed (and still defaults to `true`), disabling it (by setting to `false`) is not supported if compression is enabled (by passing a finite value for `IContainerRuntimeOptions.compressionOptions.minimumBatchSizeInBytes`).

#### Change details

Commit: [`92b695a`](https://github.com/microsoft/FluidFramework/commit/92b695aa4b36eee41a4d235a71c6408d2c70b54b)

Affected packages:

- @fluidframework/container-runtime

[‚¨ÜÔ∏è Table of contents](#contents)

### üõ†Ô∏è Start Building Today!

Please continue to engage with us on GitHub [Discussion](https://github.com/microsoft/FluidFramework/discussions) and [Issue](https://github.com/microsoft/FluidFramework/issues) pages as you adopt Fluid Framework!
