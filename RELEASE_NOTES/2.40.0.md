<!-- THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. -->

# Fluid Framework v2.40.0

## Contents

- [üö® Breaking Changes](#-breaking-changes)
  - [ITokenClaims and ScopeType re-exports have been removed (#24530)](#itokenclaims-and-scopetype-re-exports-have-been-removed-24530)
  - [IContainer.getContainerPackageInfo has been removed (#24525)](#icontainergetcontainerpackageinfo-has-been-removed-24525)
- [üå≥ SharedTree DDS Changes](#-sharedtree-dds-changes)
  - [AllowedTypes array handling has been updated (#24484)](#allowedtypes-array-handling-has-been-updated-24484)
  - [SchemaFactoryAlpha.object has been renamed to SchemaFactoryAlpha.objectAlpha (#24478)](#schemafactoryalphaobject-has-been-renamed-to-schemafactoryalphaobjectalpha-24478)
  - [SchemaFactoryAlpha supports adding metadata to AllowedTypes (#24478)](#schemafactoryalpha-supports-adding-metadata-to-allowedtypes-24478)
  - [A SharedTree document corruption bug has been fixed (#24565)](#a-sharedtree-document-corruption-bug-has-been-fixed-24565)
  - [The extractPersistedSchema (alpha) API has had its arguments adjusted (#24562)](#the-extractpersistedschema-alpha-api-has-had-its-arguments-adjusted-24562)
- [‚ö†Ô∏è Deprecations](#Ô∏è-deprecations)
  - [IFluidHandleInternal.bind has been deprecated (#24553)](#ifluidhandleinternalbind-has-been-deprecated-24553)
- [Legacy API Changes](#legacy-api-changes)
  - [IDetachedBlobStorage (deprecated) has been removed from Loader (#24490)](#idetachedblobstorage-deprecated-has-been-removed-from-loader-24490)
  - [IntervalCollections types (deprecated) have been removed (#24489)](#intervalcollections-types-deprecated-have-been-removed-24489)

## üö® Breaking Changes

### ITokenClaims and ScopeType re-exports have been removed ([#24530](https://github.com/microsoft/FluidFramework/issues/24530))

Import from `@fluidframework/driver-definitions/legacy` as needed. See issue [#23702](https://github.com/microsoft/FluidFramework/issues/23702).

#### Change details

Commit: [`665a9f4`](https://github.com/microsoft/FluidFramework/commit/665a9f4b1b412883c0666c5a0818c3f2d054daef)

Affected packages:

- @fluidframework/azure-client

[‚¨ÜÔ∏è Table of contents](#contents)

### IContainer.getContainerPackageInfo has been removed ([#24525](https://github.com/microsoft/FluidFramework/issues/24525))

`IContainer.getContainerPackageInfo()` was set to be removed in release 2.40.0. To access the package name `getContainerPackageInfo()` provided, use `IFluidCodeDetails.package` returned by `IContainer.getLoadedCodeDetails()`.

See [issue #23898](https://github.com/microsoft/FluidFramework/issues/23898) for more information.

#### Change details

Commit: [`15a5412`](https://github.com/microsoft/FluidFramework/commit/15a541265ba6293bf24e95308a5e667d5f7e9794)

Affected packages:

- @fluidframework/container-definitions
- @fluidframework/container-loader
- fluid-framework

[‚¨ÜÔ∏è Table of contents](#contents)

## üå≥ SharedTree DDS Changes

### AllowedTypes array handling has been updated ([#24484](https://github.com/microsoft/FluidFramework/issues/24484))

As an optimization, how [AllowedTypes](https://fluidframework.com/docs/api/fluid-framework/allowedtypes-typealias) arrays are processed has changed. Now much larger arrays can be provided without hitting:

> "Type instantiation is excessively deep and possibly infinite.ts"

Previously, arrays of around 43 schema would start having this issue, but now arrays of hundreds work correctly.

This optimization has resulted in a small change in behavior for how [input types](https://fluidframework.com/docs/api/fluid-framework/input-typealias) are computed. When the `AllowedTypes` array has a type that is a union of two arrays, and the two arrays start with the same subsequence of types, previously this would allow the types from the common prefix of the arrays. For example `[typeof A] | [typeof A, typeof B]` would permit inserting content compatible with `A`. Now all such unions produce `never` for their insertable node types (just like this example would if the order of the second array were reversed). This case was not intentionally supported, and as documented in [input types](https://fluidframework.com/docs/api/fluid-framework/input-typealias), non-exact types, like these unions, are not guaranteed to produce anything other than `never`.

If providing exact schema is impractical and the previous behavior is required, convert the union of arrays to an array of unions. The above example can be turned into `[typeof A, typeof B | typeof A]`.

This is also fix for a case where [AllowedTypes](https://fluidframework.com/docs/api/fluid-framework/allowedtypes-typealias) was order dependent, which violates its documented order independence.

#### Change details

Commit: [`f0a71cc`](https://github.com/microsoft/FluidFramework/commit/f0a71ccce7a055e99ce9f4ba15e1cede529bbc9c)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

### SchemaFactoryAlpha.object has been renamed to SchemaFactoryAlpha.objectAlpha ([#24478](https://github.com/microsoft/FluidFramework/issues/24478))

This rename was done so that changes can be made to the signature of the class. This is a breaking change and uses of `SchemaFactoryAlpha.object` may need to be changed to `SchemaFactoryAlpha.objectAlpha`.

#### Change details

Commit: [`12e5ab3`](https://github.com/microsoft/FluidFramework/commit/12e5ab3b335a8af263e1cc84f8951cf02db79b8b)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

### SchemaFactoryAlpha supports adding metadata to AllowedTypes ([#24478](https://github.com/microsoft/FluidFramework/issues/24478))

This change allows metadata to be added to [`AllowedTypes`](https://fluidframework.com/docs/api/fluid-framework/allowedtypes-typealias) as well as individual types in a set of `AllowedTypes`. Users can define custom metadata by putting their `AllowedTypes` in an object with `metadata` and `types` properties:

```typescript
schemaFactoryAlpha.arrayAlpha({
  metadata: {
    custom: "these allowed types are annotated",
  },
  types: [SchemaFactory.string, SchemaFactory.number],
});
```

This annotation system will also be used to implement future schema features.

#### Change details

Commit: [`12e5ab3`](https://github.com/microsoft/FluidFramework/commit/12e5ab3b335a8af263e1cc84f8951cf02db79b8b)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

### A SharedTree document corruption bug has been fixed ([#24565](https://github.com/microsoft/FluidFramework/issues/24565))

There was a bug where local changes were not correctly sent to peers. This could lead to a permanent loss of consistency and ultimately document corruption. See [PR24561](https://github.com/microsoft/FluidFramework/pull/24561) for details.

#### Change details

Commit: [`6b3e150`](https://github.com/microsoft/FluidFramework/commit/6b3e15039543a2bab4de5b2e969301f0e7f1f3db)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

### The extractPersistedSchema (alpha) API has had its arguments adjusted ([#24562](https://github.com/microsoft/FluidFramework/issues/24562))

The [extractPersistedSchema](https://fluidframework.com/docs/api/tree/#extractpersistedschema-function) function has been updated to take in [SimpleTreeSchema](https://fluidframework.com/docs/api/fluid-framework/simpletreeschema-interface). This makes it possible to use with simple schema derived from stored schema, like those returned from [ITreeAlpha.exportSimpleSchema](https://fluidframework.com/docs/api/fluid-framework/itreealpha-interface#exportsimpleschema-methodsignature). Like [TreeAlpha.exportCompressed](https://fluidframework.com/docs/api/tree#treealpha-variable), `extractPersistedSchema` now takes in [FluidClientVersion](https://fluidframework.com/docs/api/fluid-framework/fluidclientversion-enum) to make it possible to opt into newer formats when they become available.

Additionally, `persistedToSimpleSchema` has been added to fill in a gap in the API. Without `persistedToSimpleSchema` it would be impossible to parse the persisted format without a valid compressed tree to provide to [independentInitializedView](https://fluidframework.com/docs/api/tree/#independentinitializedview-functionc).

#### Change details

Commit: [`2e6b0cf`](https://github.com/microsoft/FluidFramework/commit/2e6b0cfd74f3c3db5ce3b6b3f8ff8decbfc24ab6)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

## ‚ö†Ô∏è Deprecations

### IFluidHandleInternal.bind has been deprecated ([#24553](https://github.com/microsoft/FluidFramework/issues/24553))

Handle binding is an internal concept used to make sure objects attach to the Container graph when their handle is stored in a DDS which is itself attached. The source of the "bind" operation has been assumed to be any handle, but only one implementation is actually supported (`SharedObjectHandle`, not exported itself).

So the `bind` function is now deprecated on the `IFluidHandleInterface`, moving instead to internal types supporting the one valid implementation. It's also deprecated on the various exported handle implementations that don't support it (each is either no-op, pass-through, or throwing).

No replacement is offered, this API was never meant to be called from outside of the Fluid Framework.

#### Change details

Commit: [`8a4362a`](https://github.com/microsoft/FluidFramework/commit/8a4362a7edef3a97fee13c9d23bea49448ba2a6a)

Affected packages:

- @fluidframework/container-runtime
- @fluidframework/core-interfaces
- @fluidframework/datastore
- @fluidframework/runtime-utils
- @fluidframework/shared-object-base
- @fluid-private/test-dds-utils
- @fluid-private/test-end-to-end-tests
- @fluidframework/test-runtime-utils
- @fluid-experimental/tree

[‚¨ÜÔ∏è Table of contents](#contents)

## Legacy API Changes

### IDetachedBlobStorage (deprecated) has been removed from Loader ([#24490](https://github.com/microsoft/FluidFramework/issues/24490))

It is no longer necessary or supported to provide `detachedBlobStorage` to the Loader. This functionality is now provided by default, and the deprecated `IDetachedBlobStorage` has been removed.

#### Change details

Commit: [`ef47644`](https://github.com/microsoft/FluidFramework/commit/ef47644da889d13b81c7233c3afe8600eaa1600f)

Affected packages:

- @fluidframework/container-loader

[‚¨ÜÔ∏è Table of contents](#contents)

### IntervalCollections types (deprecated) have been removed ([#24489](https://github.com/microsoft/FluidFramework/issues/24489))

This change removes the following deprecated generic types and provides non-generic alternatives where necessary:

- `IIntervalCollection` is replaced by `ISequenceIntervalCollection`
- `IIntervalCollectionEvent` is replaced by `ISequenceIntervalCollectionEvents`
- `IntervalIndex` is replaced by `SequenceIntervalIndex`
- `IOverlappingIntervalsIndex` is replaced by `ISequenceOverlappingIntervalsIndex`
- `ISharedIntervalCollection` is deprecated without replacement

These types are no longer required to be generic, and replacing them with non-generic alternatives keeps the typing less complex.

#### Change details

Commit: [`a686c35`](https://github.com/microsoft/FluidFramework/commit/a686c353c5801a4bc90958eee355fcdf30b3fbfa)

Affected packages:

- @fluidframework/sequence

[‚¨ÜÔ∏è Table of contents](#contents)

### üõ†Ô∏è Start Building Today!

Please continue to engage with us on GitHub [Discussion](https://github.com/microsoft/FluidFramework/discussions) and [Issue](https://github.com/microsoft/FluidFramework/issues) pages as you adopt Fluid Framework!
