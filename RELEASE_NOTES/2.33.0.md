<!-- THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. -->

# Fluid Framework v2.33.0

## Contents

- [‚ú® New Features](#-new-features)
  - [Latest and LatestMap support more types (#24417)](#latest-and-latestmap-support-more-types-24417)
- [üå≥ SharedTree DDS Changes](#-sharedtree-dds-changes)
  - [Improve handling of deleted nodes (#24345)](#improve-handling-of-deleted-nodes-24345)
  - [allowUnused utility function (#24076)](#allowunused-utility-function-24076)
  - [Typing derived from unions of AllowedTypes arrays is fixed (#24441)](#typing-derived-from-unions-of-allowedtypes-arrays-is-fixed-24441)
  - [Remote edits to nodes which have never been accessed locally correctly trigger "treeChanged" events (#24421)](#remote-edits-to-nodes-which-have-never-been-accessed-locally-correctly-trigger-treechanged-events-24421)
  - ["Unsafe" @system types moved to System_Unsafe namespace (#24443)](#unsafe-system-types-moved-to-system_unsafe-namespace-24443)
- [‚ö†Ô∏è Deprecations](#Ô∏è-deprecations)
  - [Generic types for IntervalCollections have been replaced with non-generic types (#24164)](#generic-types-for-intervalcollections-have-been-replaced-with-non-generic-types-24164)
- [Other Changes](#other-changes)
  - [Presence APIs have been renamed (#24384)](#presence-apis-have-been-renamed-24384)
  - [Presence object is accessible from Workspaces and State objects (#24396)](#presence-object-is-accessible-from-workspaces-and-state-objects-24396)
  - [StateFactory.latest/latestMap take an object as its only argument (#24414)](#statefactorylatestlatestmap-take-an-object-as-its-only-argument-24414)

## ‚ú® New Features

### Latest and LatestMap support more types ([#24417](https://github.com/microsoft/FluidFramework/issues/24417))

- `Latest` (`StateFactory.latest`) permits `null` so that nullable types may be used.
- `LatestMap` (`StateFactory.latestMap`) permits `boolean`, `number`, `string`, and `null`.

#### Change details

Commit: [`619af0b`](https://github.com/microsoft/FluidFramework/commit/619af0b05e23c469feb754e93351b7edca1a74a4)

Affected packages:

- @fluidframework/presence

[‚¨ÜÔ∏è Table of contents](#contents)

## üå≥ SharedTree DDS Changes

### Improve handling of deleted nodes ([#24345](https://github.com/microsoft/FluidFramework/issues/24345))

[TreeNodes](https://fluidframework.com/docs/api/fluid-framework/treenode-class) which are [deleted](https://fluidframework.com/docs/api/fluid-framework/treestatus-enum#deleted-enummember) were not handled correctly. This has been improved in two ways:

1. Accessing fields of deleted nodes now consistently throws a usage error indicating that doing so is invalid. Previously, this would throw an assertion error, which was a bug.
2. When a `TreeNode` is deleted, but that node still exists within the [`ITree`](https://fluidframework.com/docs/api/driver-definitions/itree-interface), then becomes accessible again later, a new `TreeNode` is now allocated instead of trying to reuse the deleted one. Note that this can only happen when the entire view of the `ITree` is disposed then recreated. This happens when disposing and recreating a [TreeView](https://fluidframework.com/docs/api/fluid-framework/treeview-interface) or when the contents of the view are disposed due to being out of schema (another client did a schema upgrade), then brought back into schema (the schema upgrade was undone).

#### Change details

Commit: [`0ab3e51`](https://github.com/microsoft/FluidFramework/commit/0ab3e510db5371e40c7f6b0fec3eef40695bcc94)

Affected packages:

- @fluidframework/tree
- fluid-framework

[‚¨ÜÔ∏è Table of contents](#contents)

### allowUnused utility function ([#24076](https://github.com/microsoft/FluidFramework/issues/24076))

A new `allowUnused` utility function has been added, which discards its type or runtime argument. When TypeScript is configured to reject code with unused locals, this function can be used to suppress that error, enabling use of [ValidateRecursiveSchema](https://fluidframework.com/docs/api/fluid-framework/validaterecursiveschema-typealias) to compile.

```typescript
class Test extends sf.arrayRecursive("Test", () => Test) {} // Bad
allowUnused<ValidateRecursiveSchema<typeof Test>>(); // Reports compile error due to invalid schema above.
```

#### Change details

Commit: [`13c62b6`](https://github.com/microsoft/FluidFramework/commit/13c62b613e8a3f919c0e41d0ffc582c984504f0d)

Affected packages:

- @fluidframework/tree
- fluid-framework

[‚¨ÜÔ∏è Table of contents](#contents)

### Typing derived from unions of AllowedTypes arrays is fixed ([#24441](https://github.com/microsoft/FluidFramework/issues/24441))

Unions of array types provided as an [AllowedTypes](https://fluidframework.com/docs/api/fluid-framework/allowedtypes-typealias) used to result in incorrectly computed insertable content types. This happened because [InsertableTreeNodeFromAllowedTypes](https://fluidframework.com/docs/api/fluid-framework/insertabletreenodefromallowedtypes-typealias) distributed over the union, violating the policy documented in [Input](https://fluidframework.com/docs/api/fluid-framework/input-typealias) for how schema-derived input types should be computed. This has been fixed. To get usable Input types, SharedTree schema's types should always capture the exact schema provided at runtime and not unions of possible different schema. Any code impacted by this change should be updated to replace any such unions with more specific types.

#### Change details

Commit: [`a27ef0a`](https://github.com/microsoft/FluidFramework/commit/a27ef0a0939a0983be85362d1aa34df7735977ed)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

### Remote edits to nodes which have never been accessed locally correctly trigger "treeChanged" events ([#24421](https://github.com/microsoft/FluidFramework/issues/24421))

There was a bug where "treeChanged" events would not always trigger if the node that was edited had never been accessed in the current view. This has been fixed.

#### Change details

Commit: [`916ad05`](https://github.com/microsoft/FluidFramework/commit/916ad0546f772b744e1c150c6e833199c2f713ef)

Affected packages:

- @fluidframework/tree
- fluid-framework

[‚¨ÜÔ∏è Table of contents](#contents)

### "Unsafe" @system types moved to System_Unsafe namespace ([#24443](https://github.com/microsoft/FluidFramework/issues/24443))

Working code conforming to the [rules regarding API Support Levels](https://fluidframework.com/docs/build/releases-and-apitags#api-support-levels) should be unaffected, but this resolves an issue which required violating these rules and directly referencing `@system` types.

Sometimes packages exporting SharedTree schema related types for recursive schema could yield errors like:

> error TS2742: The inferred type of 'YourSchema' cannot be named without a reference to '../node_modules/@fluidframework/tree/lib/internalTypes.js'. This is likely not portable. A type annotation is necessary.

Mitigating this error could require explicitly referencing these `@system` types from `internalTypes`. Any such references to the moved types should be able to be deleted, as TypeScript will now be able to find them in the new namespace without assistance.

This does not migrate all types out of `internalTypes`, so some occurrences of this issue may remain.

#### Change details

Commit: [`dd4abfc`](https://github.com/microsoft/FluidFramework/commit/dd4abfc4570aff9ce37c3e6bcee23cf4c7eb6e7e)

Affected packages:

- fluid-framework
- @fluidframework/tree

[‚¨ÜÔ∏è Table of contents](#contents)

## ‚ö†Ô∏è Deprecations

### Generic types for IntervalCollections have been replaced with non-generic types ([#24164](https://github.com/microsoft/FluidFramework/issues/24164))

This change deprecates the following generic types and provides non-generic alternatives where necessary:

- `IIntervalCollection` is replaced by `ISequenceIntervalCollection`
- `IIntervalCollectionEvent` is replaced by `ISequenceIntervalCollectionEvents`
- `IntervalIndex` is replaced by `SequenceIntervalIndex`
- `IOverlappingIntervalsIndex` is replaced by `ISequenceOverlappingIntervalsIndex`
- `ISharedIntervalCollection` is deprecated without replacement

These types are no longer required to be generic, and replacing them with non-generic alternatives keeps our typing less complex.

#### Change details

Commit: [`280e2bc`](https://github.com/microsoft/FluidFramework/commit/280e2bca7d5b6d8a9f61248c05d440f72f889b12)

Affected packages:

- fluid-framework
- @fluidframework/sequence

[‚¨ÜÔ∏è Table of contents](#contents)

## Other Changes

### Presence APIs have been renamed ([#24384](https://github.com/microsoft/FluidFramework/issues/24384))

The following API changes have been made to improve clarity and consistency:

| Before 2.33.0 | 2.33.0 |
| --- | --- |
| `acquirePresence` | `getPresence` |
| `acquirePresenceViaDataObject` | `getPresenceViaDataObject` |
| `ClientSessionId` | `AttendeeId` |
| `IPresence` | `Presence` |
| `IPresence.events["attendeeJoined"]` | `Presence.attendees.events["attendeeConnected"]` |
| `IPresence.events["attendeeDisconnected"]` | `Presence.attendees.events["attendeeDisconnected"]` |
| `IPresence.getAttendee` | `Presence.attendees.getAttendee` |
| `IPresence.getAttendees` | `Presence.attendees.getAttendees` |
| `IPresence.getMyself` | `Presence.attendees.getMyself` |
| `IPresence.getNotifications` | `Presence.notifications.getWorkspace` |
| `IPresence.getStates` | `Presence.states.getWorkspace` |
| `ISessionClient` | `Attendee` |
| `Latest` (import) | `StateFactory` |
| `Latest` (call) | `StateFactory.latest` |
| `LatestEvents.updated` | `LatestRawEvents.remoteUpdated` |
| `LatestMap` (import) | `StateFactory` |
| `LatestMap` (call) | `StateFactory.latestMap` |
| `LatestMapEvents.itemRemoved` | `LatestMapRawEvents.remoteItemRemoved` |
| `LatestMapEvents.itemUpdated` | `LatestMapRawEvents.remoteItemUpdated` |
| `LatestMapEvents.updated` | `LatestMapRawEvents.remoteUpdated` |
| `LatestMapItemValueClientData` | `LatestMapItemUpdatedClientData` |
| `LatestMapValueClientData` | `LatestMapClientData` |
| `LatestMapValueManager` | `LatestMapRaw` |
| `LatestMapValueManager.clients` | `LatestMapRaw.getStateAttendees` |
| `LatestMapValueManager.clientValue` | `LatestMapRaw.getRemote` |
| `LatestMapValueManager.clientValues` | `LatestMapRaw.getRemotes` |
| `LatestMapValueManagerEvents` | `LatestMapRawEvents` |
| `LatestValueClientData` | `LatestClientData` |
| `LatestValueData` | `LatestData` |
| `LatestValueManager` | `LatestRaw` |
| `LatestValueManager.clients` | `LatestRaw.getStateAttendees` |
| `LatestValueManager.clientValue` | `LatestRaw.getRemote` |
| `LatestValueManager.clientValues` | `LatestRaw.getRemotes` |
| `LatestValueManagerEvents` | `LatestRawEvents` |
| `LatestValueMetadata` | `LatestMetadata` |
| `PresenceEvents.attendeeDisconnected` | `AttendeesEvents.attendeeDisconnected` |
| `PresenceEvents.attendeeJoined` | `AttendeesEvents.attendeeConnected` |
| `PresenceNotifications` | `NotificationsWorkspace` |
| `PresenceNotifications.props` | `NotificationsWorkspace.notifications` |
| `PresenceNotificationsSchema` | `NotificationsWorkspaceSchema` |
| `PresenceStates` | `StatesWorkspace` |
| `PresenceStates.props` | `StatesWorkspace.states` |
| `PresenceStatesEntries` | `StatesWorkspaceEntries` |
| `PresenceStatesSchema` | `StatesWorkspaceSchema` |
| `PresenceWorkspaceAddress` | `WorkspaceAddress` |
| `PresenceWorkspaceEntry` | `StatesWorkspaceEntry` |
| `SessionClientStatus` | `AttendeeStatus` |
| `ValueMap` | `StateMap` |

> \[!NOTE]
>
> To fully replace the former `Latest` and `LatestMap` functions, you should import `StateFactory` and call `StateFactory.latest` and `StateFactory.latestMap` respectively. The new `LatestRaw` and `LatestMapRaw` APIs replace `LatestValueManager` and `LatestMapValueManager` respectively.

#### Change details

Commit: [`ea95ef0`](https://github.com/microsoft/FluidFramework/commit/ea95ef0a4f372c3fe01187a24515dafc1bfcef91)

Affected packages:

- @fluidframework/presence

[‚¨ÜÔ∏è Table of contents](#contents)

### Presence object is accessible from Workspaces and State objects ([#24396](https://github.com/microsoft/FluidFramework/issues/24396))

Users can now access the `Presence` object through `.presence` on all Workspaces and State objects:

`Latest.presence` `LatestMap.presence` `Notifications.presence` `NotificationsWorkspace.presence` `StatesWorkspace.presence`

#### Change details

Commit: [`c056567`](https://github.com/microsoft/FluidFramework/commit/c056567dcdfaf5cc126e0487db2451220d3609ba)

Affected packages:

- @fluidframework/presence

[‚¨ÜÔ∏è Table of contents](#contents)

### StateFactory.latest/latestMap take an object as its only argument ([#24414](https://github.com/microsoft/FluidFramework/issues/24414))

The `StateFactory.latest` and `StateFactory.latestMap` functions now take a single object argument. To convert existing code, pass any initial data in the `local` argument and broadcast settings in the `settings` argument. For example:

Before:

```ts
const statesWorkspace = presence.states.getWorkspace("name:workspace", {
  cursor: StateFactory.latest(
    { x: 0, y: 0 },
    { allowableUpdateLatencyMs: 100 },
  ),
});
```

After:

```ts
const statesWorkspace = presence.states.getWorkspace("name:workspace", {
  cursor: StateFactory.latest({
    local: { x: 0, y: 0 },
    settings: { allowableUpdateLatencyMs: 100 },
  }),
});
```

#### Change details

Commit: [`446d418`](https://github.com/microsoft/FluidFramework/commit/446d418376907317179b19b1111c170b9120103c)

Affected packages:

- @fluidframework/presence

[‚¨ÜÔ∏è Table of contents](#contents)

### üõ†Ô∏è Start Building Today!

Please continue to engage with us on GitHub [Discussion](https://github.com/microsoft/FluidFramework/discussions) and [Issue](https://github.com/microsoft/FluidFramework/issues) pages as you adopt Fluid Framework!
