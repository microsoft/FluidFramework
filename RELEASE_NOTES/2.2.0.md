<!-- THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. -->

# Fluid Framework v2.2.0

## Contents

- [üå≥ SharedTree DDS changes](#-sharedtree-dds-changes)
  - [Implicit TreeNode construction improvements (#21995)](#implicit-treenode-construction-improvements-21995)
  - [Fix document-corrupting bug when rebasing over move compositions. (#21993)](#fix-document-corrupting-bug-when-rebasing-over-move-compositions-21993)
  - [Allow constructing ArrayNodes from Maps and MapNodes from arrays when unambiguous. (#22036)](#allow-constructing-arraynodes-from-maps-and-mapnodes-from-arrays-when-unambiguous-22036)
  - [Allow `Record` typed object to be used to construct MapNodes. (#22042)](#allow-record-typed-object-to-be-used-to-construct-mapnodes-22042)
- [Deprecations](#deprecations)
  - [Deprecated summarizeProtocolTree and it's corresponding duplicate ILoaderOptions definition from container layer. (#21999)](#deprecated-summarizeprotocoltree-and-its-corresponding-duplicate-iloaderoptions-definition-from-container-layer-21999)

## üå≥ SharedTree DDS changes

### Implicit TreeNode construction improvements ([#21995](https://github.com/microsoft/FluidFramework/issues/21995))

ArrayNodes and MapNodes could always be explicitly constructed (using `new`) from iterables. The types also allowed using of iterables to construct implicitly construct array nodes and map nodes, but this did not work at runtime. This has been fixed for all cases except implicitly constructing an ArrayNode form an `Iterable` that is actually a `Map`, and implicitly constructing a MapNode from an `Iterable` that is actually an `Array`. These cases may be fixed in the future, but require additional work to ensure unions of array nodes and map nodes work correctly.

Additionally MapNodes can now be constructed from `Iterator<readonly [string, content]>` where previously the inner arrays had to be mutable.

#### Change details

Commit: [`977f96c`](https://github.com/microsoft/FluidFramework/commit/977f96c1a0dd1d5eb0dbcd087d07cb7510d533ea)

Affected packages:

- fluid-framework
- @fluidframework/tree

### Fix document-corrupting bug when rebasing over move compositions. ([#21993](https://github.com/microsoft/FluidFramework/issues/21993))

Before this fix, if multiple users concurrently performed moves (possibly by reverting prior moves), there was a chance that the document would become corrupted.

#### Change details

Commit: [`f3af9d1`](https://github.com/microsoft/FluidFramework/commit/f3af9d1cd3f7ee1ea3660ae934ddca8473fbdb9b)

Affected packages:

- @fluidframework/tree

### Allow constructing ArrayNodes from Maps and MapNodes from arrays when unambiguous. ([#22036](https://github.com/microsoft/FluidFramework/issues/22036))

Since the types for ArrayNodes and MapNodes indicate they can be constructed from iterables, it should work, even if those iterables are themselves arrays or maps. To avoid this being a breaking change, a priority system was introduced. ArrayNodes will only be implicitly constructable from JavaScript Map objects in contexts where no MapNodes are allowed. Similarly MapNodes will only be implicitly constructable from JavaScript Array objects in contexts where no ArrayNodes are allowed.

In practice, the main case in which this is likely to matter is when implicitly constructing a map node. If you provide an array of key value pairs, this now works instead of erroring, as long as no ArrayNode is valid at that location in the tree.

```typescript
class MyMapNode extends schemaFactory.map("x", schemaFactory.number) {}
class Root extends schemaFactory.object("root", { data: MyMapNode }) {}
// This now works (before it compiled, but error at runtime):
const fromArray = new Root({ data: [["x", 5]] });
```

Prior versions used to have to do:

```typescript
new Root({ data: new MyMapNode([["x", 5]]) });
```

or:

```typescript
new Root({ data: new Map([["x", 5]]) });
```

Both of these options still work: strictly more cases are allowed with this change.

#### Change details

Commit: [`25e74f9`](https://github.com/microsoft/FluidFramework/commit/25e74f9f3bed6e6ff041c088813c4cc1ea276b9c)

Affected packages:

- @fluidframework/tree
- fluid-framework

### Allow `Record` typed object to be used to construct MapNodes. ([#22042](https://github.com/microsoft/FluidFramework/issues/22042))

It is now allowed to construct MapNodes from `Record` typed objects, similar to how maps are expressed in JSON.

Before this change, an `Iterable<string, Child>` was required, but now an object like `{key1: Child1, key2: Child2}` is allowed.

Full example using this new API:

```typescript
class Schema extends schemaFactory.map("ExampleMap", schemaFactory.number) {}
const fromRecord = new Schema({ x: 5 });
```

This new feature makes it possible for schemas to construct a tree entirely from JSON compatible objects using their constructors, as long as they do not require unhydrated nodes to differentiate ambiguous unions, or IFluidHandles (which themselevs are not JSON compatible).

Due to limitations of TypeScript and recursive types, recursive maps do not advertise support for this feature in their typing, but it works at runtime.

#### Change details

Commit: [`25deff3`](https://github.com/microsoft/FluidFramework/commit/25deff344b447380486c1efb64ed69177c32ddc5)

Affected packages:

- fluid-framework
- @fluidframework/tree

## Deprecations

### Deprecated summarizeProtocolTree and it's corresponding duplicate ILoaderOptions definition from container layer. ([#21999](https://github.com/microsoft/FluidFramework/issues/21999))

summarizeProtocolTree property in ILoaderOptions was added to test single-commit summaries during the initial implementation phase. The flag is no longer required and should no longer be used, so marked it as deprecated. If a driver needs to enable or disable single-commit summaries, it can do so via IDocumentServicePolicies.

#### Change details

Commit: [`11ccda1`](https://github.com/microsoft/FluidFramework/commit/11ccda15970a10de00facfebfc060bece4a459ba)

Affected packages:

- @fluidframework/container-loader

### üõ†Ô∏è Start Building Today!

Please continue to engage with us on GitHub [Discussion](https://github.com/microsoft/FluidFramework/discussions) and [Issue](https://github.com/microsoft/FluidFramework/issues) pages as you adopt Fluid Framework!
