# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

# build-docs leaf template to build docs via docker container

parameters:
- name: BASE_URL
  type: string

- name: THIS_VERSION
  type: string

- name: MASTER_BRANCH_VERSION
  type: string

- name: N1_VERSION
  type: string

- name: RELEASE_VERSION
  type: string

- name: VUEPRESS_BASE
  type: string
  default: '/'

- name: DOCKER_CONTAINER_NAME
  type: string
  default: fluid-docs

- name: DOCKER_TARGET
  type: string
  default: docs

- name: artifactName
  type: string
  default: fluid-docs

steps:
- checkout: self
  clean: true

# Download the api-extractor outputs
- download: common_definitions
  artifact: _api-extractor-temp
- download: common_utils
  artifact: _api-extractor-temp
- download: client
  artifact: _api-extractor-temp
- download: server
  artifact: _api-extractor-temp

- script: |
    echo BASE_URL: $(BASE_URL)
    echo THIS_VERSION: $(THIS_VERSION)
    echo RELEASE_VERSION: $(RELEASE_VERSION)
    echo MASTER_BRANCH_VERSION: $(MASTER_BRANCH_VERSION)
    echo N1_VERSION: $(N1_VERSION)
  displayName: Show Template Variables

# Copy and merge the api-extractor outputs to a central location
- task: CopyFiles@2
  displayName: 'Copy _api-extractor-temp'
  inputs:
    SourceFolder: $(Pipeline.Workspace)
    Contents: '**/*.api.json'
    TargetFolder: '$(Build.SourcesDirectory)/_api-extractor-temp'
    OverWrite: false
    flattenFolders: true
    CleanTargetFolder: true

# Publish the static site as a pipeline artifact
- publish: '$(Build.SourcesDirectory)/_api-extractor-temp'
  artifact: ${{ parameters.artifactName }}
