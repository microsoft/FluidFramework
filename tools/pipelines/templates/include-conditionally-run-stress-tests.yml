# Copyright (c) Microsoft Corporation and contributors. All rights reserved.
# Licensed under the MIT License.

# include-conditionally-run-stress-tests
# Checks if

parameters:
- name: testPackage
  type: string

- name: testFileTarName
  type: string

- name: testCommand
  type: string
  default: test:stress

- name: fuzzTestCount
  type: number
  default: 1 # The test command may auto-inject how many fuzz tests to run.

- name: affectedPaths
  type: string

- name: testWorkspace
  type: string

- name: pool
  type: object
  default: Small

jobs:
  - template: templates/include-test-real-service.yml
    parameters:
      poolBuild: ${{ parameters.pool }}
      extraDependencies: mocha @fluid-internal/stochastic-test-utils
      testPackage: ${{ parameters.testPackage }}
      testWorkspace: ${{ parameters.testWorkspace }}
      timeoutInMinutes: 120
      testFileTarName: ${{ parameters.testFileTarName }}
      testCommand: ${{ parameters.testCommand }}
      env:
        FUZZ_TEST_COUNT: ${{ parameters.fuzzTestCount }}
        FUZZ_STRESS_RUN: true
