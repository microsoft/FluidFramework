# Copyright (c) Microsoft Corporation and contributors. All rights reserved.
# Licensed under the MIT License.

# include-publish-npm-package

parameters:
- name: namespace
  type: boolean

- name: tagName
  type: string

- name: publishNonScopedPackages
  type: boolean
  default: false

stages:
- stage: publish_npm_internal_test
  dependsOn: build
  displayName: Publish Internal Test Packages
  condition: and(succeeded(), eq(variables['testBuild'], true))
  jobs:
  - template: include-publish-npm-package-steps.yml
    parameters:
      namespace: ${{ parameters.namespace }}
      feedName: https://pkgs.dev.azure.com/fluidframework/internal/_packaging/test/npm/registry/
      environment: test-package-build-feed
      official: false
      artifact: pack-scoped
  - ${{ if eq(parameters.publishNonScopedPackages, true) }}:  
    - template: include-publish-npm-package-steps.yml
      parameters:
        namespace: false
        feedName: https://pkgs.dev.azure.com/fluidframework/internal/_packaging/test/npm/registry/
        environment: test-package-build-feed
        official: false
        artifact: pack-non-scoped
