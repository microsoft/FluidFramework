# This Yaml Document has been converted by ESAI Yaml Pipeline Conversion Tool.
# Please make sure to check all the converted content, it is your team's responsibility to make sure that the pipeline is still valid and functions as expected.
parameters:
- name: buildDirectory
  type: string
- name: enableCache
  type: boolean
  default: true
- name: pnpmStorePath
  type: string
  default: $(Pipeline.Workspace)/.pnpm-store
steps:
- ${{ if eq(parameters.enableCache, true) }}:
  - task: Cache@2
    displayName: Cache pnpm store
    timeoutInMinutes: 3
    continueOnError: true
    inputs:
      key: 'pnpm-store | "$(Agent.OS)" | ${{ parameters.buildDirectory }}/pnpm-lock.yaml'
      path: ${{ parameters.pnpmStorePath }}
      restoreKeys: |
        pnpm-store | "$(Agent.OS)"
- task: Bash@3
  displayName: Install and configure pnpm
  inputs:
    targetType: 'inline'
    workingDirectory: ${{ parameters.buildDirectory }}
    condition: or(succeeded(), canceled())
    script: |
      echo "Using node $(node --version)"
      sudo corepack enable
      echo "Using pnpm $(pnpm -v)"
      pnpm config set store-dir ${{ parameters.pnpmStorePath }}
      pnpm config set -g workspace-concurrency 0