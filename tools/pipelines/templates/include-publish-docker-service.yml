# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

# include-publish-docker-service

parameters:
- name: containerRegistry
  type: string
- name: containerTag
  type: string
- name: containerRegistryUrl
  type: string
- name: containerName
  type: string

- name: buildNumberInPatch
  type: string
  default:
- name: buildDirectory
  type: string
  default:
- name: tagName
  type: string
  default:

stages:
- stage: publish_docker_official
  dependsOn: build
  displayName: Publish Stage - Official Docker Image
  condition: and(succeeded(), eq(variables['release'], 'release'))
  jobs:
  - job:
    steps:
    - template: include-publish-docker-service-steps.yml
      parameters:
        environment: container-registry-public
        containerRegistry: ${{ parameters.containerRegistry }}
        containerTag: ${{ parameters.containerTag }}
        containerRegistryUrl: ${{ parameters.containerRegistryUrl }}
        containerName: public/${{ parameters.containerName }}
    - template: include-git-tag-steps.yml
      parameters:
        buildNumberInPatch: ${{ parameters.buildNumberInPatch }}
        buildDirectory: ${{ parameters.buildDirectory }}
        tagName: ${{ parameters.tagName }}

