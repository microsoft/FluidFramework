{"kind":"Class","title":"TaskManager Class","summary":"The TaskManager distributed data structure tracks queues of clients that want to exclusively run a task.\n\nIt is still experimental and under development. Please do try it out, but expect breaking changes in the future.","members":{"Method":{"_getTaskQueues":"/docs/apis/task-manager/taskmanager#_gettaskqueues-Method","abandon":"/docs/apis/task-manager/taskmanager#abandon-Method","applyStashedOp":"/docs/apis/task-manager/taskmanager#applystashedop-Method","create":"/docs/apis/task-manager/taskmanager#create-Method","getFactory":"/docs/apis/task-manager/taskmanager#getfactory-Method","haveTaskLock":"/docs/apis/task-manager/taskmanager#havetasklock-Method","lockTask":"/docs/apis/task-manager/taskmanager#locktask-Method","queued":"/docs/apis/task-manager/taskmanager#queued-Method"},"Constructor":{"(constructor)":"/docs/apis/task-manager/taskmanager#_constructor_-Constructor"}},"package":"@fluid-experimental/task-manager","unscopedPackageName":"task-manager"}

[//]: # (Do not edit this file. It is automatically generated by API Documenter.)

[Packages](/docs/apis/) &gt; [@fluid-experimental/task-manager](/docs/apis/task-manager) &gt; [TaskManager](/docs/apis/task-manager/taskmanager)

The TaskManager distributed data structure tracks queues of clients that want to exclusively run a task.

It is still experimental and under development. Please do try it out, but expect breaking changes in the future.

<b>Signature:</b>

```typescript
export declare class TaskManager extends SharedObject<ITaskManagerEvents> implements ITaskManager 
```
<b>Extends:</b> [SharedObject](/docs/apis/shared-object-base/sharedobject)<!-- -->&lt;[ITaskManagerEvents](/docs/apis/task-manager/itaskmanagerevents)

<b>Implements:</b> [ITaskManager](/docs/apis/task-manager/itaskmanager)

## Remarks

### Creation

To create a `TaskManager`<!-- -->, call the static create method:

```typescript
const taskManager = TaskManager.create(this.runtime, id);
```
### Usage

To volunteer for a task, use the `lockTask()` method. This returns a Promise that will resolve once the client has acquired exclusive rights to run the task, or reject if the client is removed from the queue without acquiring the rights.

```typescript
taskManager.lockTask("NameOfTask")
    .then(() => { doTheTask(); })
    .catch((err) => { console.error(err); });
```
To release the rights to the task, use the `abandon()` method. The next client in the queue will then get the rights to run the task.

```typescript
taskManager.abandon("NameOfTask");
```
To inspect your state in the queue, you can use the `queued()` and `haveTaskLock()` methods.

```typescript
if (taskManager.queued("NameOfTask")) {
    console.log("This client is somewhere in the queue, potentially even having the lock");
}

if (taskManager.queued("NameOfTask")) {
    console.log("This client currently has the rights to run the task");
}
```
### Eventing

`TaskManager` is an `EventEmitter`<!-- -->, and will emit events when a task is assigned to the client or released.

```typescript
taskManager.on("assigned", (taskId: string) => {
    console.log(`Client was assigned task: ${taskId}`);
});

taskManager.on("lost", (taskId: string) => {
    console.log(`Client released task: ${taskId}`);
});
```
These can be useful if the logic to volunteer for a task is separated from the logic to perform the task and it's not convenient to pass the Promise around.

## Constructors

<table class="table table-striped table-hover constructor-list">
<caption>List of constructors for this class</caption>
  <thead>
    <tr>
     <th scope="col">Constructor</th>
 <th scope="col">Modifiers</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#_constructor_-Constructor'>(constructor)(id, runtime, attributes)</a></td>
      <td></td>
      <td>Constructs a new task manager. If the object is non-local an id and service interfaces will be provided</td>
    </tr>
  </tbody>
</table>

## Methods

<table class="table table-striped table-hover method-list">
<caption>List of methods on this class</caption>
  <thead>
    <tr>
     <th scope="col">Method</th>
 <th scope="col">Modifiers</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#_gettaskqueues-Method'>_getTaskQueues()</a></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#abandon-Method'>abandon(taskId)</a></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#applystashedop-Method'>applyStashedOp()</a></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#create-Method'>create(runtime, id)</a></td>
      <td><code>static</code></td>
      <td>Create a new TaskManager</td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#getfactory-Method'>getFactory()</a></td>
      <td><code>static</code></td>
      <td>Get a factory for TaskManager to register with the data store.</td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#havetasklock-Method'>haveTaskLock(taskId)</a></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#locktask-Method'>lockTask(taskId)</a></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><a href='/docs/apis/task-manager/taskmanager#queued-Method'>queued(taskId)</a></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>

<hr><div id=class-details>

## Constructor Details {#constructors-details}

### TaskManager.(constructor) {#_constructor_-Constructor}

Constructs a new task manager. If the object is non-local an id and service interfaces will be provided

<b>Signature:</b>

```typescript
constructor(id: string, runtime: IFluidDataStoreRuntime, attributes: IChannelAttributes);
```

#### Parameters {#_constructor_-Constructor-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
      <td>string</td>
      <td>optional name of the task queue</td>
    </tr>
    <tr>
      <td>runtime</td>
      <td><a href='/docs/apis/datastore-definitions/ifluiddatastoreruntime'>IFluidDataStoreRuntime</a></td>
      <td>data store runtime the task queue belongs to</td>
    </tr>
    <tr>
      <td>attributes</td>
      <td><a href='/docs/apis/datastore-definitions/ichannelattributes'>IChannelAttributes</a></td>
      <td></td>
    </tr>
  </tbody>
</table>


## Method Details {#methods-details}

### \_getTaskQueues {#_gettaskqueues-Method}

<b>Signature:</b>

```typescript
_getTaskQueues(): Map<string, string[]>;
```

### abandon {#abandon-Method}

<b>Signature:</b>

```typescript
abandon(taskId: string): void;
```

#### Parameters {#abandon-Method-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>taskId</td>
      <td>string</td>
      <td></td>
    </tr>
  </tbody>
</table>

### applyStashedOp {#applystashedop-Method}

<b>Signature:</b>

```typescript
applyStashedOp(): void;
```

### create {#create-Method}

Create a new TaskManager

<b>Signature:</b>

```typescript
static create(runtime: IFluidDataStoreRuntime, id?: string): TaskManager;
```

#### Parameters {#create-Method-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>runtime</td>
      <td><a href='/docs/apis/datastore-definitions/ifluiddatastoreruntime'>IFluidDataStoreRuntime</a></td>
      <td>data store runtime the new task queue belongs to</td>
    </tr>
    <tr>
      <td>id</td>
      <td>string</td>
      <td>optional name of the task queue</td>
    </tr>
  </tbody>
</table>

#### Returns {#create-Method-returns}


newly create task queue (but not attached yet)

<b>Return type(s):</b> [TaskManager](/docs/apis/task-manager/taskmanager)

### getFactory {#getfactory-Method}

Get a factory for TaskManager to register with the data store.

<b>Signature:</b>

```typescript
static getFactory(): IChannelFactory;
```

#### Returns {#getfactory-Method-returns}


a factory that creates and load TaskManager

<b>Return type(s):</b> [IChannelFactory](/docs/apis/datastore-definitions/ichannelfactory)

### haveTaskLock {#havetasklock-Method}

<b>Signature:</b>

```typescript
haveTaskLock(taskId: string): boolean;
```

#### Parameters {#havetasklock-Method-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>taskId</td>
      <td>string</td>
      <td></td>
    </tr>
  </tbody>
</table>

### lockTask {#locktask-Method}

<b>Signature:</b>

```typescript
lockTask(taskId: string): Promise<void>;
```

#### Parameters {#locktask-Method-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>taskId</td>
      <td>string</td>
      <td></td>
    </tr>
  </tbody>
</table>

### queued {#queued-Method}

<b>Signature:</b>

```typescript
queued(taskId: string): boolean;
```

#### Parameters {#queued-Method-parameters}


<table class="table table-striped table-hover param-list">
<caption>List of parameters</caption>
  <thead>
    <tr>
     <th scope="col">Parameter</th>
 <th scope="col">Type</th>
 <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>taskId</td>
      <td>string</td>
      <td></td>
    </tr>
  </tbody>
</table>


</div>
