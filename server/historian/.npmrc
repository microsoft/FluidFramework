engine-strict=true
frozen-lockfile=true
strict-peer-dependencies=true
link-workspace-packages=true

# Block packages published less than 24 hours ago to avoid supply chain attacks.
minimum-release-age=1440

# We would prefer to use time-based resolution to avoid pulling in the newest packages from npm. This delays ingestion
# of newly published packages, which helps avoid supply chain attacks.
#
# However, with resolution-mode=time-based, the "anchor" time for a transitive dep is the time at which the depending
# package was released. For example, consider if we depend on PackageA, and it depends on PackageB=^1.0.0. At the time
# PackageA was published, t0, PackageB was at 1.0.0. But then PackageB released an update 2 weeks later, 1.1.0. That
# version still match PackageA's dep range, so it's a valid version to match, but it is released outside the t0 + 24
# hours window established by PackageA's original release, so pnpm blocks it as a resolvable version.
#
# This is all fine and desired behavior. However, pnpm does NOT go looking for a different version that does work. In
# other words, it won't downwardly resolve to 1.0.0 because that's what was available at the time. It's not clear what
# happens if I manually set the resolution to 1.0.0 in the lockfile, then re-resolve (i.e. no frozen lockfile) -- I
# think you just wind up in the same place UNLESS you have the 1.0.0 version in your local pnpm cache and it doesn't
# look for the latest.
#
# Anyway, when the dep is out of the time window, pnpm just throws an error, and as far as I can tell, you can either
# ignore the dep in the npmrc, in which case you get the latest version of transitive deps UNLESS they themselves were
# published with 24 hours (my hypothesis is that the logic basically just sets the "anchor" date to now when
# resolution-mode is not time-based and otherwise behaves the same, which explains some of the error messages).
resolution-mode=highest

# Block transitive dependencies from using exotic sources (git, tarballs).
# Only direct dependencies can use those - all subdeps must come from the registry.
block-exotic-subdeps=true

# Fail installation if a package's trust/verification level decreases compared to earlier releases.
trust-policy=no-downgrade

# Fail installation if dependencies have unreviewed build scripts.
strict-dep-builds=true

# Disable pnpm update notifications since we use corepack to install package managers
update-notifier=false
# Use the number of cores on the machine by default.
workspace-concurrency=0
