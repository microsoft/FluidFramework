<html>

<body>
    <div style='padding: 3px; display: inline-block;'><a>Link:</a><input style='min-width: 800px;' id='link'> </input>
    </div>
    <div style='padding: 3px; display: inline-block;'><a>Token (SPO only):</a><input style='min-width: 800px;'
            id='token'> </input></div>

    <div style='padding: 3px; display: inline-block;'><a>Client Id (SPO only):</a><input style='min-width: 800px;'
            id='clientId'> </input></div>

    <div style='padding: 3px; display: inline-block;'><a>Client Secret (SPO only):</a><input style='min-width: 800px;'
            id='clientSecret'> </input></div>
    <p>The "SPO only" fields are used with the tenant spo or spo-df.</p>
    <select id="hostingMode">
        <option value='div'>Host in DIV</option>
        <option value='iframe'>Host in IFrame</option>
    </select>
    <select id="layoutMode">
        <option value='fixed'>Expand to fixed size</option>
        <option value='dynamic'>Contract to component size</option>
    </select>
    <button id='go' onclick='go()'>go</button>

    <div id='container'></div>
    <script>
        function go() {
            const useIframe = document.getElementById('hostingMode').value === 'iframe';
            const useFixedSize = document.getElementById('layoutMode').value === 'fixed';

            storeThings();
            const iframe = document.createElement('iframe');
            const container = document.getElementById('container');
            iframe.id = `theframe${container.childElementCount}`;
            iframe.style.height = '45vw';
            iframe.style.width = '45vw';
            iframe.style.maxHeight = '1000px';
            iframe.style.maxWidth = iframe.style.maxHeight;
            iframe.style.display = 'block';

            const iFrameContainerDiv = document.createElement('div');
            iFrameContainerDiv.id = `thediv${container.childElementCount}`;
            iFrameContainerDiv.style.display = 'inline-block';

            const closeButton = document.createElement('button');
            closeButton.textContent = 'CLOSE';
            closeButton.style.width = '45vw';
            closeButton.style.maxWidth = iframe.style.maxWidth;
            closeButton.style.display = 'block';
            closeButton.onclick = () => {
                document.getElementById(iframe.id).remove();
                const removeDiv = document.getElementById(iFrameContainerDiv.id);
                removeDiv.style.visibility = 'hidden';
                removeDiv.style.width = '0px';
                removeDiv.style.height = '0px';
            }

            iFrameContainerDiv.appendChild(iframe);
            iFrameContainerDiv.appendChild(closeButton);
            container.appendChild(iFrameContainerDiv);

            container.app

            const rawframe = document.getElementById(iframe.id);
            const framedoc = rawframe.contentDocument;
            if (!framedoc && rawframe.contentWindow) {
                framedoc = rawframe.contentWindow.document;
            }
            var loadPragueScript = document.createElement('script');
            loadPragueScript.type = "text/javascript";
            loadPragueScript.src = "dist/main.bundle.js";
            loadPragueScript.onload = () => {
                const runScript = document.createElement('script');
                if (useIframe) {
                    runScript.text = `
            tinyWebLoader.loadIFramedPragueComponent(
                    "${document.getElementById('link').value}",
                    () => {"${document.getElementById('token').value}"},
                    document.getElementById('prague-component'),
                    "${document.getElementById('clientId').value}",
                    "${document.getElementById('clientSecret').value}",
                    );`;
                } else {
                    runScript.text = `
            tinyWebLoader.loadPragueComponent(
                    "${document.getElementById('link').value}",
                    () => {"${document.getElementById('token').value}"},
                    document.getElementById('prague-component'),
                    "${document.getElementById('clientId').value}",
                    "${document.getElementById('clientSecret').value}",
                    );`;
                }
                framedoc.body.appendChild(runScript);
            }

            framedoc.body.style.margin = '0';
            framedoc.body.appendChild(loadPragueScript);

            const newdiv = document.createElement('div');
            newdiv.id = 'content';
            newdiv.style.position = "absolute";
            if (useFixedSize) {
                newdiv.style.top = "0";
                newdiv.style.left = "0";
                newdiv.style.bottom = "0";
                newdiv.style.right = "0";
            }
            framedoc.body.appendChild(newdiv);
        }

        function fillThings() {
            const token = localStorage.getItem('token');
            const link = localStorage.getItem('link');
            if (token) document.getElementById('token').value = token;
            if (link) document.getElementById('link').value = link;
        }
        function storeThings() {
            localStorage.setItem('token', document.getElementById('token').value);
            localStorage.setItem('link', document.getElementById('link').value);
        }

        fillThings();

    </script>
    <style>
        iframe {
            border: 1px dotted darkgray;
        }
    </style>
</body>

</html>