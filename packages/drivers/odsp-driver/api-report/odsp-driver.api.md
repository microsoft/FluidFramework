## API Report File for "@fluidframework/odsp-driver"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts

import { DriverPreCheckInfo } from '@fluidframework/driver-definitions/internal';
import { HostStoragePolicy } from '@fluidframework/odsp-driver-definitions/internal';
import { IContainerPackageInfo } from '@fluidframework/driver-definitions/internal';
import { IdentityType } from '@fluidframework/odsp-driver-definitions/internal';
import { IDocumentService } from '@fluidframework/driver-definitions/internal';
import { IDocumentServiceFactory } from '@fluidframework/driver-definitions/internal';
import { IEntry } from '@fluidframework/odsp-driver-definitions/internal';
import { IFileEntry } from '@fluidframework/odsp-driver-definitions/internal';
import { IOdspResolvedUrl } from '@fluidframework/odsp-driver-definitions/internal';
import { IOdspUrlParts } from '@fluidframework/odsp-driver-definitions/internal';
import { IPersistedCache } from '@fluidframework/odsp-driver-definitions/internal';
import { IRelaySessionAwareDriverFactory } from '@fluidframework/odsp-driver-definitions/internal';
import { IRequest } from '@fluidframework/core-interfaces';
import { IResolvedUrl } from '@fluidframework/driver-definitions/internal';
import { ISequencedDocumentMessage } from '@fluidframework/driver-definitions';
import { ISharingLinkKind } from '@fluidframework/odsp-driver-definitions/internal';
import { ISnapshot } from '@fluidframework/driver-definitions/internal';
import { ISnapshotOptions } from '@fluidframework/odsp-driver-definitions/internal';
import { ISnapshotTree } from '@fluidframework/driver-definitions/internal';
import { ISocketStorageDiscovery } from '@fluidframework/odsp-driver-definitions/internal';
import { ISummaryTree } from '@fluidframework/driver-definitions';
import { ITelemetryBaseLogger } from '@fluidframework/core-interfaces';
import { ITelemetryBaseProperties } from '@fluidframework/core-interfaces';
import { ITelemetryLoggerExt } from '@fluidframework/telemetry-utils/internal';
import { IUrlResolver } from '@fluidframework/driver-definitions/internal';
import { OdspResourceTokenFetchOptions } from '@fluidframework/odsp-driver-definitions/internal';
import { PromiseCache } from '@fluidframework/core-utils/internal';
import { RateLimiter } from '@fluidframework/driver-utils/internal';
import { TokenFetcher } from '@fluidframework/odsp-driver-definitions/internal';

// @alpha
export function checkUrl(documentUrl: URL): DriverPreCheckInfo | undefined;

// @internal (undocumented)
export enum ClpCompliantAppHeader {
    // (undocumented)
    isClpCompliantApp = "X-CLP-Compliant-App"
}

// @alpha
export function createLocalOdspDocumentServiceFactory(localSnapshot: Uint8Array | string): IDocumentServiceFactory;

// @alpha
export function createOdspCreateContainerRequest(siteUrl: string, driveId: string, filePath: string, fileName: string, createShareLinkType?: ISharingLinkKind): IRequest;

// @alpha
export function createOdspUrl(l: OdspFluidDataStoreLocator): string;

// @alpha
export function encodeOdspFluidDataStoreLocator(locator: OdspFluidDataStoreLocator): string;

// @alpha
export class EpochTracker implements IPersistedFileCache {
    constructor(cache: IPersistedCache, fileEntry: IFileEntry, logger: ITelemetryLoggerExt, clientIsSummarizer?: boolean | undefined);
    // (undocumented)
    protected readonly cache: IPersistedCache;
    // (undocumented)
    protected readonly clientIsSummarizer?: boolean | undefined;
    fetch(url: string, fetchOptions: RequestInit, fetchType: FetchType, addInBody?: boolean, fetchReason?: string): Promise<IOdspResponse<Response>>;
    fetchAndParseAsJSON<T>(url: string, fetchOptions: RequestInit, fetchType: FetchType, addInBody?: boolean, fetchReason?: string): Promise<IOdspResponse<T>>;
    fetchArray(url: string, fetchOptions: {
        [index: string]: RequestInit;
    }, fetchType: FetchType, addInBody?: boolean, fetchReason?: string): Promise<IOdspResponse<ArrayBuffer>>;
    // (undocumented)
    protected readonly fileEntry: IFileEntry;
    // (undocumented)
    get fluidEpoch(): string | undefined;
    // (undocumented)
    get(entry: IEntry): Promise<any>;
    // (undocumented)
    protected readonly logger: ITelemetryLoggerExt;
    // (undocumented)
    put(entry: IEntry, value: any): Promise<void>;
    // (undocumented)
    readonly rateLimiter: RateLimiter;
    // (undocumented)
    removeEntries(): Promise<void>;
    // (undocumented)
    setEpoch(epoch: string, fromCache: boolean, fetchType: FetchTypeInternal): void;
    // (undocumented)
    validateEpoch(epoch: string | undefined, fetchType: FetchType): Promise<void>;
    // (undocumented)
    protected validateEpochFromResponse(epochFromResponse: string | undefined, fetchType: FetchTypeInternal, fromCache?: boolean): void;
}

// @alpha (undocumented)
export type FetchType = "blob" | "createBlob" | "createFile" | "joinSession" | "ops" | "test" | "snapshotTree" | "treesLatest" | "uploadSummary" | "push" | "versions";

// @alpha (undocumented)
export type FetchTypeInternal = FetchType | "cache";

// @alpha
export function getHashedDocumentId(driveId: string, itemId: string): Promise<string>;

// @alpha
export function getLocatorFromOdspUrl(url: URL, requireFluidSignature?: boolean): OdspFluidDataStoreLocator | undefined;

// @internal
export function getOdspUrlParts(url: URL): Promise<IOdspUrlParts | undefined>;

// @alpha (undocumented)
export interface ICacheAndTracker {
    // (undocumented)
    cache: IOdspCache;
    // (undocumented)
    epochTracker: EpochTracker;
}

// @internal (undocumented)
export interface IClpCompliantAppHeader {
    // (undocumented)
    [ClpCompliantAppHeader.isClpCompliantApp]: boolean;
}

// @alpha
export interface INonPersistentCache {
    readonly fileUrlCache: PromiseCache<string, IOdspResolvedUrl>;
    readonly sessionJoinCache: PromiseCache<string, {
        entryTime: number;
        joinSessionResponse: ISocketStorageDiscovery;
    }>;
    readonly snapshotPrefetchResultCache: PromiseCache<string, IPrefetchSnapshotContents>;
}

// @alpha
export interface IOdspCache extends INonPersistentCache {
    readonly persistedCache: IPersistedFileCache;
}

// @alpha (undocumented)
export interface IOdspResponse<T> {
    // (undocumented)
    content: T;
    // (undocumented)
    duration: number;
    // (undocumented)
    headers: Map<string, string>;
    // (undocumented)
    propsToLog: ITelemetryBaseProperties;
}

// @alpha
export interface IPersistedFileCache {
    // (undocumented)
    get(entry: IEntry): Promise<any>;
    // (undocumented)
    put(entry: IEntry, value: any): Promise<void>;
    // (undocumented)
    removeEntries(): Promise<void>;
}

// @alpha (undocumented)
export interface IPrefetchSnapshotContents extends ISnapshot {
    // (undocumented)
    fluidEpoch: string;
    // (undocumented)
    prefetchStartTime: number;
}

// @internal (undocumented)
export interface ISharingLinkHeader {
    // (undocumented)
    [SharingLinkHeader.isSharingLinkToRedeem]: boolean;
}

// @alpha @deprecated (undocumented)
export interface ISnapshotContents {
    // (undocumented)
    blobs: Map<string, ArrayBuffer>;
    latestSequenceNumber: number | undefined;
    // (undocumented)
    ops: ISequencedDocumentMessage[];
    sequenceNumber: number | undefined;
    // (undocumented)
    snapshotTree: ISnapshotTree;
}

// @internal
export interface ISnapshotContentsWithProps extends ISnapshot {
    // (undocumented)
    telemetryProps: Record<string, number>;
}

// @internal
export function isOdcUrl(url: URL): boolean;

// @internal
export function isOdspResolvedUrl(resolvedUrl: IResolvedUrl): resolvedUrl is IOdspResolvedUrl;

// @internal
export function isSpoUrl(url: URL): boolean;

// @alpha
export const locatorQueryParamName = "nav";

// @alpha (undocumented)
export const OdcApiSiteOrigin = "https://my.microsoftpersonalcontent.com";

// @alpha (undocumented)
export const OdcFileSiteOrigin = "https://1drv.ms";

// @alpha
export class OdspDocumentServiceFactory extends OdspDocumentServiceFactoryCore {
    constructor(getStorageToken: TokenFetcher<OdspResourceTokenFetchOptions>, getWebsocketToken: TokenFetcher<OdspResourceTokenFetchOptions> | undefined, persistedCache?: IPersistedCache, hostPolicy?: HostStoragePolicy);
}

// @alpha
export class OdspDocumentServiceFactoryCore implements IDocumentServiceFactory, IRelaySessionAwareDriverFactory {
    constructor(getStorageToken: TokenFetcher<OdspResourceTokenFetchOptions>, getWebsocketToken: TokenFetcher<OdspResourceTokenFetchOptions> | undefined, persistedCache?: IPersistedCache, hostPolicy?: HostStoragePolicy);
    // (undocumented)
    createContainer(createNewSummary: ISummaryTree | undefined, createNewResolvedUrl: IResolvedUrl, logger?: ITelemetryBaseLogger, clientIsSummarizer?: boolean): Promise<IDocumentService>;
    // (undocumented)
    createDocumentService(resolvedUrl: IResolvedUrl, logger?: ITelemetryBaseLogger, clientIsSummarizer?: boolean): Promise<IDocumentService>;
    // (undocumented)
    protected createDocumentServiceCore(resolvedUrl: IResolvedUrl, odspLogger: ITelemetryBaseLogger, cacheAndTrackerArg?: ICacheAndTracker, clientIsSummarizer?: boolean): Promise<IDocumentService>;
    getRelayServiceSessionInfo(resolvedUrl: IResolvedUrl): Promise<ISocketStorageDiscovery | undefined>;
    // (undocumented)
    get IRelaySessionAwareDriverFactory(): this;
    // (undocumented)
    protected persistedCache: IPersistedCache;
    // (undocumented)
    get snapshotPrefetchResultCache(): PromiseCache<string, IPrefetchSnapshotContents>;
}

// @internal @deprecated (undocumented)
export class OdspDocumentServiceFactoryWithCodeSplit extends OdspDocumentServiceFactoryCore implements IDocumentServiceFactory {
    constructor(getStorageToken: TokenFetcher<OdspResourceTokenFetchOptions>, getWebsocketToken: TokenFetcher<OdspResourceTokenFetchOptions> | undefined, persistedCache?: IPersistedCache, hostPolicy?: HostStoragePolicy);
}

// @alpha
export class OdspDriverUrlResolver implements IUrlResolver {
    constructor();
    getAbsoluteUrl(resolvedUrl: IResolvedUrl, relativeUrl: string, packageInfoSource?: IContainerPackageInfo): Promise<string>;
    resolve(request: IRequest): Promise<IOdspResolvedUrl>;
}

// @alpha
export class OdspDriverUrlResolverForShareLink implements IUrlResolver {
    constructor(shareLinkFetcherProps?: ShareLinkFetcherProps | undefined, logger?: ITelemetryBaseLogger, appName?: string | undefined, getContext?: ((resolvedUrl: IOdspResolvedUrl, dataStorePath: string) => Promise<string | undefined>) | undefined);
    appendDataStorePath(requestUrl: URL, pathToAppend: string): string | undefined;
    appendLocatorParams(baseUrl: string, resolvedUrl: IResolvedUrl, dataStorePath: string, packageInfoSource?: IContainerPackageInfo): Promise<string>;
    static createDocumentUrl(baseUrl: string, driverInfo: OdspFluidDataStoreLocator): string;
    getAbsoluteUrl(resolvedUrl: IResolvedUrl, dataStorePath: string, packageInfoSource?: IContainerPackageInfo): Promise<string>;
    resolve(request: IRequest): Promise<IOdspResolvedUrl>;
}

// @alpha (undocumented)
export interface OdspFluidDataStoreLocator extends IOdspUrlParts {
    // (undocumented)
    appName?: string;
    // (undocumented)
    containerPackageName?: string;
    // (undocumented)
    context?: string;
    // (undocumented)
    dataStorePath: string;
    // (undocumented)
    fileVersion?: string;
}

// @internal
export function parseCompactSnapshotResponse(buffer: Uint8Array, logger: ITelemetryLoggerExt): ISnapshotContentsWithProps;

// @alpha
export function prefetchLatestSnapshot(resolvedUrl: IResolvedUrl, getStorageToken: TokenFetcher<OdspResourceTokenFetchOptions>, persistedCache: IPersistedCache, forceAccessTokenViaAuthorizationHeader: boolean, logger: ITelemetryBaseLogger, hostSnapshotFetchOptions: ISnapshotOptions | undefined, enableRedeemFallback?: boolean, fetchBinarySnapshotFormat?: boolean, snapshotFormatFetchType?: SnapshotFormatSupportType, odspDocumentServiceFactory?: OdspDocumentServiceFactory): Promise<boolean>;

// @alpha
export interface ShareLinkFetcherProps {
    identityType: IdentityType;
    tokenFetcher: TokenFetcher<OdspResourceTokenFetchOptions>;
}

// @internal (undocumented)
export enum SharingLinkHeader {
    // (undocumented)
    isSharingLinkToRedeem = "isSharingLinkToRedeem"
}

// @alpha
export enum SnapshotFormatSupportType {
    // (undocumented)
    Binary = 1,
    // (undocumented)
    Json = 0,
    // (undocumented)
    JsonAndBinary = 2
}

// @alpha
export function storeLocatorInOdspUrl(url: URL, locator: OdspFluidDataStoreLocator): void;

// (No @packageDocumentation comment for this package)

```
