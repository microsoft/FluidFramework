{"version":3,"file":"fluidSyncedArray.js","sourceRoot":"","sources":["../../../src/syncedObjects/array/fluidSyncedArray.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,OAAO,EAAE,oBAAoB,EAAE,MAAM,0BAA0B,CAAC;AAChE,OAAO,EAMH,eAAe,GAClB,MAAM,OAAO,CAAC;AAGf,MAAM,UAAU,yBAAyB,CAIrC,gBAAkC,EAClC,aAAqB,EACrB,OAAiB,EACjB,QAAkB,EAClB,gBAAoB,EACpB,kBAAkB,GAAG,oBAAoB,CAAC,MAAM;IAEhD,gBAAgB,CAAC,cAAc,CAAS,aAAa,EAAE;QACnD,aAAa;QACb,WAAW,EAAE,IAAI,GAAG,CAAC;YACjB;gBACI,QAAQ;gBACR;oBACI,IAAI,EAAE,oBAAoB,CAAC,IAAI;oBAC/B,OAAO;oBACP,aAAa,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,EAAE;wBACrC,IAAI,UAAU,CAAC,QAAQ,CAAC,KAAK,SAAS,EAAE;4BACpC,MAAM,KAAK,CAAC,iCAAiC,CAAC,CAAC;yBAClD;wBACD,SAAS,CAAC,OAAO,CAAC,GAAI,UAAU,CAC5B,QAAQ,CACH,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBACtB,OAAO,SAAS,CAAC;oBACrB,CAAC;oBACD,kBAAkB;oBAClB,cAAc,EAAE,CAAC,cAAc,CAAC;iBACnC;aACJ;SACJ,CAAC;QACF,WAAW,EAAE,IAAI,GAAG,CAAC;YACjB;gBACI,OAAO;gBACP;oBACI,IAAI,EAAE,OAAO;oBACb,QAAQ;oBACR,cAAc,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,EAAE;wBACtC,IAAI,UAAU,CAAC,QAAQ,CAAC,KAAK,SAAS,EAAE;4BACpC,MAAM,KAAK,CAAC,iCAAiC,CAAC,CAAC;yBAClD;wBACD,SAAS,CAAC,OAAO,CAAC,GAAI,UAAU,CAC5B,QAAQ,CACH,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBACtB,OAAO,UAAU,CAAC;oBACtB,CAAC;iBACJ;aACJ;SACJ,CAAC;QACF,gBAAgB;KACnB,CAAC,CAAC;AACP,CAAC;AAED,MAAM,UAAU,0BAA0B,CAGxC,OAAiB,EAAE,QAAkB;IACnC,MAAM,kBAAkB,GAAG;QACvB,GAAG,EAAE;YACD,QAAQ,EAAE,CAAC,KAAK,EAAE,KAAU,EAAE,EAAE;;gBAC5B,IAAI,OAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,UAAU,0CAAG,QAAQ,OAAM,SAAS,EAAE;oBAC7C,MAAM,KAAK,CACP,kDAAkD,CACrD,CAAC;iBACL;gBACD,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,MAAM,CAC7B,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,SAAS,EAAE,EACtC,mBAAM,KAAK,EAAG,CACjB,CAAC;gBACF,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAC1D,CAAC,CACJ,CAAC;gBACF,OAAO,EAAE,KAAK,EAAE,CAAC;YACrB,CAAC;SACJ;KACJ,CAAC;IACF,OAAO,kBAAkB,CAAC;AAC9B,CAAC;AAED,MAAM,UAAU,0BAA0B,CAItC,gBAAkC,EAClC,aAAqB,EACrB,OAAiB,EACjB,QAAkB,EAClB,gBAAoB;IAGpB,MAAM,kBAAkB,GAAG,0BAA0B,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACzE,OAAO,eAAe,CAQlB;QACI,gBAAgB;QAChB,aAAa;QACb,OAAO,EAAE,kBAAkB;QAC3B,QAAQ,EAAE,EAAE;KACf,EACD,gBAAgB,CACnB,CAAC;AACN,CAAC","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { SharedObjectSequence } from \"@fluidframework/sequence\";\nimport {\n    IViewState,\n    IFluidState,\n    SyncedDataObject,\n    ICombinedState,\n    IFluidDataProps,\n    useReducerFluid,\n} from \"../..\";\nimport { IFluidSyncedArrayReducer } from \"./interface\";\n\nexport function setFluidSyncedArrayConfig<\n    SV extends IViewState,\n    SF extends IFluidState\n>(\n    syncedDataObject: SyncedDataObject,\n    syncedStateId: string,\n    viewKey: keyof SV,\n    fluidKey: keyof SF,\n    defaultViewState: SV,\n    sharedObjectCreate = SharedObjectSequence.create,\n) {\n    syncedDataObject.setFluidConfig<SV, SF>(syncedStateId, {\n        syncedStateId,\n        fluidToView: new Map([\n            [\n                fluidKey,\n                {\n                    type: SharedObjectSequence.name,\n                    viewKey,\n                    viewConverter: (viewState, fluidState) => {\n                        if (fluidState[fluidKey] === undefined) {\n                            throw Error(\"Fluid state was not initialized\");\n                        }\n                        viewState[viewKey] = (fluidState[\n                            fluidKey\n                        ] as any).getItems(0);\n                        return viewState;\n                    },\n                    sharedObjectCreate,\n                    listenedEvents: [\"valueChanged\"],\n                },\n            ],\n        ]),\n        viewToFluid: new Map([\n            [\n                viewKey,\n                {\n                    type: \"array\",\n                    fluidKey,\n                    fluidConverter: (viewState, fluidState) => {\n                        if (fluidState[fluidKey] === undefined) {\n                            throw Error(\"Fluid state was not initialized\");\n                        }\n                        viewState[viewKey] = (fluidState[\n                            fluidKey\n                        ] as any).getItems(0);\n                        return fluidState;\n                    },\n                },\n            ],\n        ]),\n        defaultViewState,\n    });\n}\n\nexport function generateSyncedArrayReducer<\n    SV extends IViewState,\n    SF extends IFluidState\n>(viewKey: keyof SV, fluidKey: keyof SF): IFluidSyncedArrayReducer<SV, SF> {\n    const syncedArrayReducer = {\n        add: {\n            function: (state, value: any) => {\n                if (state?.fluidState?.[fluidKey] === undefined) {\n                    throw Error(\n                        \"State was not initialized prior to dispatch call\",\n                    );\n                }\n                state.fluidState[fluidKey].insert(\n                    state.fluidState[fluidKey].getLength(),\n                    [{ ...value }],\n                );\n                state.viewState[viewKey] = state.fluidState[fluidKey].getItems(\n                    0,\n                );\n                return { state };\n            },\n        },\n    };\n    return syncedArrayReducer;\n}\n\nexport function useSyncedArrayReducerFluid<\n    SV extends IViewState,\n    SF extends IFluidState\n>(\n    syncedDataObject: SyncedDataObject,\n    syncedStateId: string,\n    viewKey: keyof SV,\n    fluidKey: keyof SF,\n    defaultViewState: SV,\n// eslint-disable-next-line @typescript-eslint/ban-types\n): [ICombinedState<SV, SF, IFluidDataProps>, IFluidSyncedArrayReducer<SV, SF>, {}] {\n    const syncedArrayReducer = generateSyncedArrayReducer(viewKey, fluidKey);\n    return useReducerFluid<\n        SV,\n        SF,\n        IFluidSyncedArrayReducer<SV, SF>,\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        {},\n        IFluidDataProps\n    >(\n        {\n            syncedDataObject,\n            syncedStateId,\n            reducer: syncedArrayReducer,\n            selector: {},\n        },\n        defaultViewState,\n    );\n}\n"]}