# Fluid Framework Compatibility Types

## Overview

Fluid Framework is a distributed system where multiple clients collaborate on shared documents in real-time. This architecture creates several dimensions of compatibility that must be carefully managed:

- **Persistence**: Documents may be stored for extended periods and reopened by newer client versions
- **API stability**: Applications built on Fluid depend on stable interfaces across versions
- **Layered architecture**: Fluid's modular design (Driver, Loader, Runtime, Datastore layers) allows components to be versioned independently
- **Multi-client collaboration**: Different clients running different versions must interoperate seamlessly

This document defines and explains each compatibility type, describing what it means, why it matters, and the scenarios it enables. Understanding these distinctions helps both Fluid Framework maintainers and application developers reason about version compatibility and upgrade strategies.

> **Note:** This document does not specify the policies around what version compatibility matrix and guarantees we provide—it focuses on defining the compatibility types themselves.

## Data-at-rest compatibility

Data-at-rest compatibility implies that all FF data (ops and snapshots under the hood) generated by a client running a particular version are readable forever by all subsequent client versions. For example: client v4.0 can successfully load documents created by v1.0, v2.0 and v3.0 client as well.

### Motivation

Applications need to open documents that have been dormant for extended periods without requiring data conversions or loading through intermediate versions. Such limitations create significant friction for application developers and end users who expect seamless access to their historical documents.

## API compatibility

API compatibility implies that we cannot break existing APIs within the supported set of versions. For example, if we were to say we support compatibility of public APIs on major versions only, we could break APIs between say v1.0 and v2.0 with reasonable documentation for existing customers. Similarly, if we were to say we support compatibility for public APIs between v1.0 and v2.0, public APIs on v2.0 should be fully compatible with the same APIs on v1.0.

### Motivation

Application developers need a clear, predictable upgrade path to newer Fluid versions. When API changes occur, documented and well-communicated breaking changes allow teams to plan and execute upgrades with confidence.

## Layer compatibility

Layer compatibility implies that a single client can have different versions for different compatibility layers we support - Driver, Loader, Runtime and Datastore. For example, Driver is v2.1, Loader is v1.0, Runtime is v3.0 and Datastore is v2.0 on the same client. The APIs at the boundaries of these layers have additional compatibility concerns beyond those of the API compatibility bucket and we cannot break them within the compatibility promise.

### Motivation

This compatibility concern exists to support the following scenarios:

Dynamic loading, where code executed is retrieved from the network in a way that allows the code of each layer to change independently. This differs from other types of lazily loaded code, like webpack chunks, which are still part of the same compiled package, and will always return the same code. Because the layers can be different, each layer must support interacting with other layers of a different version.
For example, applications such as Teams compile driver / loader and they generally update at a slow pace. It dynamically Loop container which compiles Runtime and updates more frequently.

Applications can import and build from different repos. These repos can be released and updated at different frequencies. Without any compatibility, they would need to update all of them to an FF version at the same time to be interoperable. For example, Loop container complies Runtime. It imports and builds Loop components which complies Datastores. These Loop components can be on a different repo and updates at a different frequency.


### Architecture diagram

```
┌───────────────────────────────────────────────────────────────────────────────────────────┐
│ Application                                                                               │
│                                                                                           │
│  Legend:  (FF) = Fluid Framework    (Author) = Container Authors                          │
│           (Consumer) = Container Consumers                                                │
│                                                                                           │
│  ┌──────────────────┐    ┌────────────────────────────────────────────────────────────┐   │
│  │ Experience       │    │ Loader (N-2) (FF)                                          │   │
│  │ (Consumer)       │    │                                                            │   │
│  └────────▲─────────┘    │  ┌──────────────────────────────────────────────────────┐  │   │
│           └──────────────│──│ Host API (FF)                                        │  │   │
│                          │  └────────────────────────▲─────────────────────────────┘  │   │
│  ┌──────────────┐        │                           │                                │   │
│  │ Driver (N-3) │        │  ┌────────────────────────│─────────────────────────────┐  │   │
│  │ (FF)         │────────┤  │ Runtime (N-1) (FF)     │                             │  │   │
│  └──────┬───────┘        │  │                        │                             │  │   │
│         │                │  │  ┌──────────────────┐  │  ┌───────────────────────┐  │  │   │
│         │                │  │  │ Entrypoint       │  │  │  Datastores (N)       │  │  │   │
│         │                │  │  │ (Author)         │  │  │                       │  │  │   │
│         │                │  │  ├──────────────────┤  │  │  ┌─────────────────┐  │  │  │   │
│         │                │  │  │ API │ Rendering  │  │  │  │ Entrypoint      │  │  │  │   │
│         │                │  │  │ (Author)         │  │  │  │ (Author)        │  │  │  │   │
│         │                │  │  ├──────────────────┤  │  │  ├─────────────────┤  │  │  │   │
│         │                │  │  │ Business Logic   │◄─┤──│──│ API │ Rendering │  │  │  │   │
│         │                │  │  │ (Author)         │  │  │  │ (Author)        │  │  │  │   │
│         │                │  │  └────────▲─────────┘  │  │  ├─────────────────┤  │  │  │   │
│         │                │  │           │            │  │  │ Business Logic  │  │  │  │   │
│         │                │  │           │            │  │  │ (Author)        │  │  │  │   │
│         │                │  │           │            │  │  └───────▲─────────┘  │  │  │   │
│         │                │  │           │            │  │          │            │  │  │   │
│         │                │  │           │            │  │  ┌─────────────────┐  │  │  │   │
│         │                │  │           │            │  │  │ DDSes (FF)      │  │  │  │   │
│         │                │  │           │            │  │  └─────────────────┘  │  │  │   │
│         │                │  │           │            │  └──────────▲────────────┘  │  │   │
│         │                │  └───────────│────────────│─────────────│───────────────┘  │   │
│         │                └──────────────│────────────│─────────────│──────────────────┘   │
│         │                               │            │             │                      │
│         │                  ┌────────────┴────────────┴─────────────┴─────────────────┐    │
│         └─────────────────►│ Fluid Framework Services (FF)                           │    │
│                            └─────────────────────────────────────────────────────────┘    │
└───────────────────────────────────────────────────────────────────────────────────────────┘
```

This diagram shows different Fluid layers with different versions in a client:
- **Driver layer**: Fluid package version N-3.
- **Loader layer**: Fluid package version N-2.
- **Runtime layer**: Fluid package version N-1.
- **Datastore layer**: Fluid package version N.

### Details

Layer compatibility is described in more detail in [Fluid Layer Compatibility](./FluidLayerCompatibility.md).

## Cross-client compatibility

Cross-client compatibility implies that clients within a supported set of versions should be able to fully collaborate with each other. For example: say we support N / N-1 for cross-client compatibility. This means that there could be clients running runtime versions N and N-1 in parallel and they should be able to successfully collaborate (both read and write). What makes this different from data-at-rest compatibility promise is that lower version clients can read/write docs created by higher version as well.

### Motivation

During version upgrades, there is an unavoidable transition window when clients running different versions must coexist and collaborate. This compatibility ensures users can continue working together seamlessly regardless of whether their application instance has been updated yet.

### Architecture diagram

```
┌──────────────────────────────────────────────┐    ┌──────────────────────────────────────────────┐
│ Client 1 (Older Versions)                    │    │ Client 2 (Newer Versions)                    │
│                                              │    │                                              │
│  ┌────────────────────────────────────────┐  │    │  ┌────────────────────────────────────────┐  │
│  │ Application                            │  │    │  │ Application                            │  │
│  │                                        │  │    │  │                                        │  │
│  │            ┌─────────────┐             │  │    │  │            ┌─────────────┐             │  │
│  │            │ Experience  │             │  │    │  │            │ Experience  │             │  │
│  │            └──────▲──────┘             │  │    │  │            └──────▲──────┘             │  │
│  │                   │                    │  │    │  │                   │                    │  │
│  │  ┌────────────────┴─────────────────┐  │  │    │  │  ┌────────────────┴─────────────────┐  │  │
│  │  │ Loader (N-3)                     │  │  │    │  │  │ Loader (N-2)                     │  │  │
│  │  │  ┌────────────────────────────┐  │  │  │    │  │  │  ┌────────────────────────────┐  │  │  │
│  │  │  │ Runtime (N-2)              │  │  │  │    │  │  │  │ Runtime (N-1)              │  │  │  │
│  │  │  │  ┌──────────────────────┐  │  │  │  │    │  │  │  │  ┌──────────────────────┐  │  │  │  │
│  │  │  │  │ Datastores (N-1)     │  │  │  │  │    │  │  │  │  │ Datastores (N)       │  │  │  │  │
│  │  │  │  │  ┌────────────────┐  │  │  │  │  │    │  │  │  │  │  ┌────────────────┐  │  │  │  │  │
│  │  │  │  │  │ DDSes          │  │  │  │  │  │    │  │  │  │  │  │ DDSes          │  │  │  │  │  │
│  │  │  │  │  └────────────────┘  │  │  │  │  │    │  │  │  │  │  └────────────────┘  │  │  │  │  │
│  │  │  │  └──────────────────────┘  │  │  │  │    │  │  │  │  └──────────────────────┘  │  │  │  │
│  │  │  └────────────────────────────┘  │  │  │    │  │  │  └────────────────────────────┘  │  │  │
│  │  └────────────────▲─────────────────┘  │  │    │  │  └────────────────▲─────────────────┘  │  │
│  │                   │                    │  │    │  │                   │                    │  │
│  │            ┌──────┴──────┐             │  │    │  │            ┌──────┴──────┐             │  │
│  │            │ Driver (N-4)│             │  │    │  │            │ Driver (N-3)│             │  │
│  │            └──────┬──────┘             │  │    │  │            └──────┬──────┘             │  │
│  └───────────────────│────────────────────┘  │    │  └───────────────────│────────────────────┘  │
│                      │                       │    │                      │                       │
│                      ▼                       │    │                      ▼                       │
│          ┌───────────────────────┐           │    │          ┌───────────────────────┐           │
│          │ FF Services (Local)   │           │    │          │ FF Services (Local)   │           │
│          └───────────┬───────────┘           │    │          └───────────┬───────────┘           │
└──────────────────────│───────────────────────┘    └──────────────────────│───────────────────────┘
                       │                                                   │
                       │              ┌───────────────────────┐            │
                       └─────────────►│ Fluid Framework       │◄───────────┘
                                      │ Service (Shared)      │
                                      └───────────────────────┘
```

This diagram shows two clients collaborating on the same document:
- **Client 1** runs older versions: Driver (N-4), Loader (N-3), Runtime (N-2), Datastores (N-1)
- **Client 2** runs newer versions: Driver (N-3), Loader (N-2), Runtime (N-1), Datastores (N)
- Both clients communicate through a shared **Fluid Framework Service**
- Cross-client compatibility ensures these different versions can successfully collaborate (read and write) on the same document
