---
title: Types of Schema Changes
sidebar_position: 2
---

# Types of Schema Changes

Understanding which types of schema changes are safe versus breaking is crucial for evolving your [SharedTree](../index.mdx) schemas without disrupting existing applications.

## Compatible Changes

The following changes are backwards compatible at a data level.
However, it's important that applications carefully consider the application-level consequences of clients running older code collaborating with clients using the new schema.
For example, [adding allowed types] is a case in which [staged rollouts](./index.mdx#staged-rollouts) are required so that new clients writing the new allowed types do not break older clients that don't know about that type.

### Adding Optional Fields

Adding optional fields to existing node types is always safe:

```typescript
// Before
class Note extends factory.object("Note", {
    id: factory.string,
    text: factory.string,
}) {}

// After - Safe addition
class Note extends factory.object("Note", {
    id: factory.string,
    text: factory.string,
    color: factory.optional(factory.string), // New optional field
}) {}
```

For forwards compatibility, use [`allowUnknownOptionalFields`](../../../api/fluid-framework/objectnodeschema-interface#allowunknownoptionalfields-property) to handle new optional fields added by newer clients:

```typescript
class Note extends factory.object("Note", {
    id: factory.string,
    text: factory.string,
    // Existing optional fields
}, { allowUnknownOptionalFields: true }) {}
```

### Making Required Fields Optional

Converting a required field to optional is always safe:

```typescript
// Before
class Circle extends factory.object("Circle", {
    center: Point,
    radius: factory.number, // Required
}) {}

// After - Safe change
class Circle extends factory.object("Circle", {
    center: Point,
    radius: factory.optional(factory.number), // Now optional
}) {}
```

### Adding New Allowed Types

Adding new allowed types to existing fields is compatible, but may require a [staged rollout](./index.mdx#staged-rollouts) for cross-client collaboration:

```typescript
// Before
class Whiteboard extends factory.object("Whiteboard", {
    elements: factory.array([TextElement]),
}) {}

// After - Safe addition
class Whiteboard extends factory.object("Whiteboard", {
    elements: factory.array([TextElement, ImageElement]), // New type added
}) {}
```

To maintain backwards compatibility, staged allowed types can be used to roll out support for reading before writing, allowing older clients to read data created with new types.

## Incompatible Changes

These changes will break compatibility with existing data and require careful migration:

### Removing Fields

Removing fields from node types breaks older clients:

```typescript
// Breaking: Removing field
class Note extends factory.object("Note", {
    id: factory.string,
    // text: factory.string, // REMOVED - breaks older clients
}) {}
```

### Making Optional Fields Required

Making an optional field required breaks documents that don't have that field:

```typescript
// Breaking: Making optional field required
class Note extends factory.object("Note", {
    id: factory.string,
    text: factory.string,
    color: factory.string, // Was optional, now required - BREAKING!
}) {}
```

### Changing Field Types

Changing field types breaks existing data:

```typescript
// Breaking: Changing field type
class Note extends factory.object("Note", {
    id: factory.string,
    position: factory.string, // Was factory.number - BREAKING!
}) {}
```

### Removing Allowed Types

Removing allowed types from fields breaks documents containing those types:

```typescript
// Breaking: Removing allowed type
class Whiteboard extends factory.object("Whiteboard", {
    elements: factory.array([TextElement]), // ImageElement removed - BREAKING!
}) {}
```

## See Also

- [Schema Evolution](./index.mdx) - Overview and upgrade process
- [Schema Definition](../schema-definition.mdx) - How to define schemas
- [Node Types](../node-types.mdx) - Understanding different node types
