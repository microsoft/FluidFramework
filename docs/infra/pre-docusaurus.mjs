/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */

import path from "node:path";
import { fileURLToPath } from "node:url";

import fs from "fs-extra";

import DocsVersions from "../config/docs-versions.mjs";
// Generated by API docs build
import GeneratedApiVersions from "../api-docs-build-manifest.json" assert { type: "json" };


// TODO: rename this file

const dirname = path.dirname(fileURLToPath(import.meta.url));

/**
 * Pre Docusaurus build script.
 * Generates configuration details required by Docusaurus that we can't define statically.
 */

// Get versions from config
const versions = [];
// Note: don't include "current" version, because Docusaurus will automatically include `/docs`.
versions.push(...DocsVersions.otherVersions.map((v) => v.version));

// Read manifest generated by the API docs build.
// If the "local" API docs were built, add the local build to `versions.json` so Docusaurus sees them.
const includeLocalApiDocs = GeneratedApiVersions.apiDocsVersions.includes("local");
if (includeLocalApiDocs) {
	versions.push(DocsVersions.local.version);
}

const versionsFilePath = path.resolve(dirname, "..", "versions.json");
await fs.writeJSON(versionsFilePath, versions);
