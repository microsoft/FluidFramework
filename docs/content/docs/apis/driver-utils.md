{
  "title": "@fluidframework/driver-utils Package",
  "kind": "Package",
  "members": {
    "Function": {
      "applyStorageCompression": "/docs/apis/driver-utils#applystoragecompression-function",
      "buildSnapshotTree": "/docs/apis/driver-utils#buildsnapshottree-function",
      "calculateMaxWaitTime": "/docs/apis/driver-utils#calculatemaxwaittime-function",
      "canBeCoalescedByService": "/docs/apis/driver-utils#canbecoalescedbyservice-function",
      "convertSummaryTreeToSnapshotITree": "/docs/apis/driver-utils#convertsummarytreetosnapshotitree-function",
      "createGenericNetworkError": "/docs/apis/driver-utils#creategenericnetworkerror-function",
      "getDocAttributesFromProtocolSummary": "/docs/apis/driver-utils#getdocattributesfromprotocolsummary-function",
      "getQuorumValuesFromProtocolSummary": "/docs/apis/driver-utils#getquorumvaluesfromprotocolsummary-function",
      "isOnline": "/docs/apis/driver-utils#isonline-function",
      "isRuntimeMessage": "/docs/apis/driver-utils#isruntimemessage-function",
      "logNetworkFailure": "/docs/apis/driver-utils#lognetworkfailure-function",
      "readAndParse": "/docs/apis/driver-utils#readandparse-function",
      "requestOps": "/docs/apis/driver-utils#requestops-function",
      "runWithRetry": "/docs/apis/driver-utils#runwithretry-function",
      "streamFromMessages": "/docs/apis/driver-utils#streamfrommessages-function",
      "streamObserver": "/docs/apis/driver-utils#streamobserver-function"
    },
    "Class": {
      "AttachmentTreeEntry": "/docs/apis/driver-utils/attachmenttreeentry-class",
      "AuthorizationError": "/docs/apis/driver-utils/authorizationerror-class",
      "BlobTreeEntry": "/docs/apis/driver-utils/blobtreeentry-class",
      "DeltaStreamConnectionForbiddenError": "/docs/apis/driver-utils/deltastreamconnectionforbiddenerror-class",
      "DocumentStorageServiceProxy": "/docs/apis/driver-utils/documentstorageserviceproxy-class",
      "FluidInvalidSchemaError": "/docs/apis/driver-utils/fluidinvalidschemaerror-class",
      "GenericNetworkError": "/docs/apis/driver-utils/genericnetworkerror-class",
      "InsecureUrlResolver": "/docs/apis/driver-utils/insecureurlresolver-class",
      "LocationRedirectionError": "/docs/apis/driver-utils/locationredirectionerror-class",
      "NetworkErrorBasic": "/docs/apis/driver-utils/networkerrorbasic-class",
      "NonRetryableError": "/docs/apis/driver-utils/nonretryableerror-class",
      "ParallelRequests": "/docs/apis/driver-utils/parallelrequests-class",
      "PrefetchDocumentStorageService": "/docs/apis/driver-utils/prefetchdocumentstorageservice-class",
      "Queue": "/docs/apis/driver-utils/queue-class",
      "RateLimiter": "/docs/apis/driver-utils/ratelimiter-class",
      "RetryableError": "/docs/apis/driver-utils/retryableerror-class",
      "ThrottlingError": "/docs/apis/driver-utils/throttlingerror-class",
      "TreeTreeEntry": "/docs/apis/driver-utils/treetreeentry-class",
      "UsageError": "/docs/apis/driver-utils/usageerror-class"
    },
    "Variable": {
      "blobHeadersBlobName": "/docs/apis/driver-utils#blobheadersblobname-variable",
      "canRetryOnError": "/docs/apis/driver-utils#canretryonerror-variable",
      "createWriteError": "/docs/apis/driver-utils#createwriteerror-variable",
      "emptyMessageStream": "/docs/apis/driver-utils#emptymessagestream-variable",
      "getRetryDelayFromError": "/docs/apis/driver-utils#getretrydelayfromerror-variable",
      "getRetryDelaySecondsFromError": "/docs/apis/driver-utils#getretrydelaysecondsfromerror-variable"
    },
    "TypeAlias": {
      "DriverErrorTelemetryProps": "/docs/apis/driver-utils#drivererrortelemetryprops-typealias"
    },
    "Interface": {
      "ICompressionStorageConfig": "/docs/apis/driver-utils/icompressionstorageconfig-interface",
      "IProgress": "/docs/apis/driver-utils/iprogress-interface"
    },
    "Enum": {
      "MessageType2": "/docs/apis/driver-utils#messagetype2-enum",
      "OnlineStatus": "/docs/apis/driver-utils#onlinestatus-enum"
    }
  },
  "package": "@fluidframework/driver-utils",
  "unscopedPackageName": "driver-utils"
}

[//]: # (Do not edit this file. It is automatically generated by @fluidtools/api-markdown-documenter.)

[Packages](/docs/apis/) &gt; [@fluidframework/driver-utils](/docs/apis/driver-utils)

## Interfaces

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Interface
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/icompressionstorageconfig-interface'>ICompressionStorageConfig</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/iprogress-interface'>IProgress</a>
      </td>
      <td>
        Interface describing an object passed to various network APIs. It allows caller to control cancellation, as well as learn about any delays.
      </td>
    </tr>
  </tbody>
</table>

## Classes

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Class
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/attachmenttreeentry-class'>AttachmentTreeEntry</a>
      </td>
      <td>
        Basic implementation of an attachment ITreeEntry
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/authorizationerror-class'>AuthorizationError</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/blobtreeentry-class'>BlobTreeEntry</a>
      </td>
      <td>
        Basic implementation of a blob ITreeEntry
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/deltastreamconnectionforbiddenerror-class'>DeltaStreamConnectionForbiddenError</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/documentstorageserviceproxy-class'>DocumentStorageServiceProxy</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/fluidinvalidschemaerror-class'>FluidInvalidSchemaError</a>
      </td>
      <td>
        FluidInvalidSchema error class.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/genericnetworkerror-class'>GenericNetworkError</a>
      </td>
      <td>
        Generic network error class.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/insecureurlresolver-class'>InsecureUrlResolver</a>
      </td>
      <td>
        <p>
          As the name implies this is not secure and should not be used in production. It simply makes the example easier to get up and running.
        </p>
        <p>
          In our example we run a simple web server via webpack-dev-server. This defines a URL format of the form http://localhost:8080/<documentId>/<path>.
        </p>
        <p>
          We then need to map that to a Fluid based URL. These are of the form fluid://orderingUrl/<tenantId>/<documentId>/<path>.
        </p>
        <p>
          The tenantId/documentId pair defines the 'full' document ID the service makes use of. The path is then an optional part of the URL that the document interprets and maps to a data store. It's exactly similar to how a web service works or a router inside of a single page app framework.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/locationredirectionerror-class'>LocationRedirectionError</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/networkerrorbasic-class'>NetworkErrorBasic</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/nonretryableerror-class'>NonRetryableError</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/parallelrequests-class'>ParallelRequests</a>
      </td>
      <td>
        Helper class to organize parallel fetching of data It can be used to concurrently do many requests, while consuming data in the right order. Take a look at UT for examples.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/prefetchdocumentstorageservice-class'>PrefetchDocumentStorageService</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/queue-class'>Queue</a>
      </td>
      <td>
        Helper queue class to allow async push / pull It's essentially a pipe allowing multiple writers, and single reader
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/ratelimiter-class'>RateLimiter</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/retryableerror-class'>RetryableError</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/throttlingerror-class'>ThrottlingError</a>
      </td>
      <td>
        Throttling error class - used to communicate all throttling errors
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/treetreeentry-class'>TreeTreeEntry</a>
      </td>
      <td>
        Basic implementation of a tree ITreeEntry
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils/usageerror-class'>UsageError</a>
      </td>
      <td>
        Error indicating an API is being used improperly resulting in an invalid operation.
      </td>
    </tr>
  </tbody>
</table>

## Enumerations

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Enum
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#messagetype2-enum'>MessageType2</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#onlinestatus-enum'>OnlineStatus</a>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

## Types

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        TypeAlias
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#drivererrortelemetryprops-typealias'>DriverErrorTelemetryProps</a>
      </td>
      <td>
        Telemetry props with driver-specific required properties
      </td>
    </tr>
  </tbody>
</table>

## Functions

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Function
      </th>
      <th>
        Return Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#applystoragecompression-function'>applyStorageCompression</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/idocumentservicefactory-interface'>IDocumentServiceFactory</a></span>
      </td>
      <td>
        This method optionally applies compression to the given document service factory. The compression must be enabled by setting the config to true or by passing a compression config object.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#buildsnapshottree-function'>buildSnapshotTree</a>
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/isnapshottree-interface'>ISnapshotTree</a></span>
      </td>
      <td>
        Build a tree hierarchy base on an array of ITreeEntry
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#calculatemaxwaittime-function'>calculateMaxWaitTime</a>
      </td>
      <td>
        <span>number</span>
      </td>
      <td>
        In case endpoint(service or socket) is not reachable, then we maybe offline or may have got some transient error not related to endpoint, in that case we want to try at faster pace and hence the max wait is lesser 8s as compared to when endpoint is reachable in which case it is 30s.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#canbecoalescedbyservice-function'>canBeCoalescedByService</a>
      </td>
      <td>
        <span>boolean</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#convertsummarytreetosnapshotitree-function'>convertSummaryTreeToSnapshotITree</a>
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/itree-interface'>ITree</a></span>
      </td>
      <td>
        Converts ISummaryTree to ITree format.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#creategenericnetworkerror-function'>createGenericNetworkError</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-utils/throttlingerror-class'>ThrottlingError</a> &#124; <a href='/docs/apis/driver-utils/genericnetworkerror-class'>GenericNetworkError</a></span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#getdocattributesfromprotocolsummary-function'>getDocAttributesFromProtocolSummary</a>
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/idocumentattributes-interface'>IDocumentAttributes</a></span>
      </td>
      <td>
        Extract the attributes from the protocol summary.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#getquorumvaluesfromprotocolsummary-function'>getQuorumValuesFromProtocolSummary</a>
      </td>
      <td>
        <span>[string, <a href='/docs/apis/protocol-definitions#icommittedproposal-typealias'>ICommittedProposal</a>][]</span>
      </td>
      <td>
        Extract quorum values from the protocol summary.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#isonline-function'>isOnline</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-utils#onlinestatus-enum'>OnlineStatus</a></span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#isruntimemessage-function'>isRuntimeMessage</a>
      </td>
      <td>
        <span>boolean</span>
      </td>
      <td>
        Tells if message was sent by container runtime
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#lognetworkfailure-function'>logNetworkFailure</a>
      </td>
      <td>
        <span>void</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#readandparse-function'>readAndParse</a>
      </td>
      <td>
        <span>Promise&lt;T&gt;</span>
      </td>
      <td>
        Read a blob from <a href='/docs/apis/driver-definitions/idocumentstorageservice-interface'>IDocumentStorageService</a> and <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse'>JSON.parse</a> it into object of type <code>T</code>.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#requestops-function'>requestOps</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/istream-interface'>IStream</a>&lt;<a href='/docs/apis/protocol-definitions/isequenceddocumentmessage-interface'>ISequencedDocumentMessage</a>[]&gt;</span>
      </td>
      <td>
        Request ops from storage
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#runwithretry-function'>runWithRetry</a>
      </td>
      <td>
        <span>Promise&lt;T&gt;</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#streamfrommessages-function'>streamFromMessages</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/istream-interface'>IStream</a>&lt;<a href='/docs/apis/protocol-definitions/isequenceddocumentmessage-interface'>ISequencedDocumentMessage</a>[]&gt;</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#streamobserver-function'>streamObserver</a>
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/istream-interface'>IStream</a>&lt;T&gt;</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

## Variables

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Variable
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#blobheadersblobname-variable'>blobHeadersBlobName</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#canretryonerror-variable'>canRetryOnError</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
        Check if a connection error can be retried. Unless explicitly allowed, retry is disallowed. I.e. asserts or unexpected exceptions in our code result in container failure.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#createwriteerror-variable'>createWriteError</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#emptymessagestream-variable'>emptyMessageStream</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#getretrydelayfromerror-variable'>getRetryDelayFromError</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
        Check retryAfterSeconds property on error and convert to ms
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#getretrydelaysecondsfromerror-variable'>getRetryDelaySecondsFromError</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
        Check retryAfterSeconds property on error
      </td>
    </tr>
  </tbody>
</table>

## Enumeration Details

### MessageType2 {#messagetype2-enum}

#### Signature {#messagetype2-signature}

```typescript
export declare enum MessageType2
```

#### Flags

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Flag
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#messagetype2-accept-enummember'>Accept</a>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

##### Accept {#messagetype2-accept-enummember}

###### Signature {#accept-signature}

```typescript
Accept = "accept"
```

### OnlineStatus {#onlinestatus-enum}

#### Signature {#onlinestatus-signature}

```typescript
export declare enum OnlineStatus
```

#### Flags

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Flag
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#onlinestatus-offline-enummember'>Offline</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#onlinestatus-online-enummember'>Online</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/driver-utils#onlinestatus-unknown-enummember'>Unknown</a>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

##### Offline {#onlinestatus-offline-enummember}

###### Signature {#offline-signature}

```typescript
Offline = 0
```

##### Online {#onlinestatus-online-enummember}

###### Signature {#online-signature}

```typescript
Online = 1
```

##### Unknown {#onlinestatus-unknown-enummember}

###### Signature {#unknown-signature}

```typescript
Unknown = 2
```

## Type Details

### DriverErrorTelemetryProps {#drivererrortelemetryprops-typealias}

Telemetry props with driver-specific required properties

#### Signature {#drivererrortelemetryprops-signature}

```typescript
export declare type DriverErrorTelemetryProps = ITelemetryProperties & {
    driverVersion: string | undefined;
};
```

## Function Details

### applyStorageCompression {#applystoragecompression-function}

This method optionally applies compression to the given document service factory. The compression must be enabled by setting the config to true or by passing a compression config object.

#### Signature {#applystoragecompression-signature}

```typescript
export declare function applyStorageCompression(documentServiceFactory: IDocumentServiceFactory, config?: ICompressionStorageConfig | boolean): IDocumentServiceFactory;
```

#### Parameters {#applystoragecompression-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        documentServiceFactory
      </td>
      <td>
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/idocumentservicefactory-interface'>IDocumentServiceFactory</a></span>
      </td>
      <td>
        The document service factory to apply compression to.
      </td>
    </tr>
    <tr>
      <td>
        config
      </td>
      <td>
        optional
      </td>
      <td>
        <span><a href='/docs/apis/driver-utils/icompressionstorageconfig-interface'>ICompressionStorageConfig</a> &#124; boolean</span>
      </td>
      <td>
        The compression configuration.
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#applystoragecompression-returns}

- The document service factory possibly with compression applied.

**Return type:** [IDocumentServiceFactory](/docs/apis/driver-definitions/idocumentservicefactory-interface)

### buildSnapshotTree {#buildsnapshottree-function}

Build a tree hierarchy base on an array of ITreeEntry

#### Signature {#buildsnapshottree-signature}

```typescript
export declare function buildSnapshotTree(entries: ITreeEntry[], blobMap: Map<string, ArrayBufferLike>): ISnapshotTree;
```

#### Parameters {#buildsnapshottree-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        entries
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions#itreeentry-typealias'>ITreeEntry</a>[]</span>
      </td>
      <td>
        an array of ITreeEntry to flatten
      </td>
    </tr>
    <tr>
      <td>
        blobMap
      </td>
      <td>
        <span>Map&lt;string, ArrayBufferLike&gt;</span>
      </td>
      <td>
        a map of blob's sha1 to content that gets filled with content from entries NOTE: blobMap's validity is contingent on the returned promise's resolution
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#buildsnapshottree-returns}

the hierarchical tree

**Return type:** [ISnapshotTree](/docs/apis/protocol-definitions/isnapshottree-interface)

### calculateMaxWaitTime {#calculatemaxwaittime-function}

In case endpoint(service or socket) is not reachable, then we maybe offline or may have got some transient error not related to endpoint, in that case we want to try at faster pace and hence the max wait is lesser 8s as compared to when endpoint is reachable in which case it is 30s.

#### Signature {#calculatemaxwaittime-signature}

```typescript
export declare function calculateMaxWaitTime(error: unknown): number;
```

#### Parameters {#calculatemaxwaittime-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        error
      </td>
      <td>
        <span>unknown</span>
      </td>
      <td>
        error based on which we decide max wait time.
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#calculatemaxwaittime-returns}

- Max wait time.

**Return type:** number

### canBeCoalescedByService {#canbecoalescedbyservice-function}

#### Signature {#canbecoalescedbyservice-signature}

```typescript
export declare function canBeCoalescedByService(message: ISequencedDocumentMessage | IDocumentMessage): boolean;
```

#### Parameters {#canbecoalescedbyservice-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        message
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/isequenceddocumentmessage-interface'>ISequencedDocumentMessage</a> &#124; <a href='/docs/apis/protocol-definitions/idocumentmessage-interface'>IDocumentMessage</a></span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#canbecoalescedbyservice-returns}

**Return type:** boolean

### convertSummaryTreeToSnapshotITree {#convertsummarytreetosnapshotitree-function}

Converts ISummaryTree to ITree format.

#### Signature {#convertsummarytreetosnapshotitree-signature}

```typescript
export declare function convertSummaryTreeToSnapshotITree(summaryTree: ISummaryTree): ITree;
```

#### Parameters {#convertsummarytreetosnapshotitree-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        summaryTree
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/isummarytree-interface'>ISummaryTree</a></span>
      </td>
      <td>
        summary tree in ISummaryTree format
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#convertsummarytreetosnapshotitree-returns}

**Return type:** [ITree](/docs/apis/protocol-definitions/itree-interface)

### createGenericNetworkError {#creategenericnetworkerror-function}

#### Signature {#creategenericnetworkerror-signature}

```typescript
export declare function createGenericNetworkError(message: string, retryInfo: {
    canRetry: boolean;
    retryAfterMs?: number;
}, props: DriverErrorTelemetryProps): ThrottlingError | GenericNetworkError;
```

#### Parameters {#creategenericnetworkerror-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        message
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        retryInfo
      </td>
      <td>
        <span>{     canRetry: boolean;     retryAfterMs?: number; }</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        props
      </td>
      <td>
        <span><a href='/docs/apis/driver-utils#drivererrortelemetryprops-typealias'>DriverErrorTelemetryProps</a></span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#creategenericnetworkerror-returns}

**Return type:** [ThrottlingError](/docs/apis/driver-utils/throttlingerror-class) \| [GenericNetworkError](/docs/apis/driver-utils/genericnetworkerror-class)

### getDocAttributesFromProtocolSummary {#getdocattributesfromprotocolsummary-function}

Extract the attributes from the protocol summary.

#### Signature {#getdocattributesfromprotocolsummary-signature}

```typescript
export declare function getDocAttributesFromProtocolSummary(protocolSummary: ISummaryTree): IDocumentAttributes;
```

#### Parameters {#getdocattributesfromprotocolsummary-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        protocolSummary
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/isummarytree-interface'>ISummaryTree</a></span>
      </td>
      <td>
        protocol summary from which the values are to be extracted.
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#getdocattributesfromprotocolsummary-returns}

**Return type:** [IDocumentAttributes](/docs/apis/protocol-definitions/idocumentattributes-interface)

### getQuorumValuesFromProtocolSummary {#getquorumvaluesfromprotocolsummary-function}

Extract quorum values from the protocol summary.

#### Signature {#getquorumvaluesfromprotocolsummary-signature}

```typescript
export declare function getQuorumValuesFromProtocolSummary(protocolSummary: ISummaryTree): [string, ICommittedProposal][];
```

#### Parameters {#getquorumvaluesfromprotocolsummary-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        protocolSummary
      </td>
      <td>
        <span><a href='/docs/apis/protocol-definitions/isummarytree-interface'>ISummaryTree</a></span>
      </td>
      <td>
        protocol summary from which the values are to be extracted.
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#getquorumvaluesfromprotocolsummary-returns}

**Return type:** \[string, [ICommittedProposal](/docs/apis/protocol-definitions#icommittedproposal-typealias)\]\[\]

### isOnline {#isonline-function}

#### Signature {#isonline-signature}

```typescript
export declare function isOnline(): OnlineStatus;
```

#### Returns {#isonline-returns}

**Return type:** [OnlineStatus](/docs/apis/driver-utils#onlinestatus-enum)

### isRuntimeMessage {#isruntimemessage-function}

Tells if message was sent by container runtime

#### Signature {#isruntimemessage-signature}

```typescript
export declare function isRuntimeMessage(message: {
    type: string;
}): boolean;
```

#### Parameters {#isruntimemessage-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        message
      </td>
      <td>
        <span>{     type: string; }</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#isruntimemessage-returns}

whether the message is a runtime message

**Return type:** boolean

### logNetworkFailure {#lognetworkfailure-function}

#### Signature {#lognetworkfailure-signature}

```typescript
export declare function logNetworkFailure(logger: ITelemetryLoggerExt, event: ITelemetryErrorEvent, error?: any): void;
```

#### Parameters {#lognetworkfailure-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        logger
      </td>
      <td>
      </td>
      <td>
        <span><a href='/docs/apis/telemetry-utils/itelemetryloggerext-interface'>ITelemetryLoggerExt</a></span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        event
      </td>
      <td>
      </td>
      <td>
        <span>ITelemetryErrorEvent</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        error
      </td>
      <td>
        optional
      </td>
      <td>
        <span>any</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

### readAndParse {#readandparse-function}

Read a blob from [IDocumentStorageService](/docs/apis/driver-definitions/idocumentstorageservice-interface) and [JSON.parse](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse) it into object of type `T`.

#### Signature {#readandparse-signature}

```typescript
export declare function readAndParse<T>(storage: Pick<IDocumentStorageService, "readBlob">, id: string): Promise<T>;
```

#### Parameters {#readandparse-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        storage
      </td>
      <td>
        <span>Pick&lt;<a href='/docs/apis/driver-definitions/idocumentstorageservice-interface'>IDocumentStorageService</a>, &quot;readBlob&quot;&gt;</span>
      </td>
      <td>
        The <code>DocumentStorageService</code> to read from.
      </td>
    </tr>
    <tr>
      <td>
        id
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The ID of the blob to read and parse.
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#readandparse-returns}

The object that we decoded and parsed via `JSON.parse`.

**Return type:** Promise&lt;T&gt;

### requestOps {#requestops-function}

Request ops from storage

#### Signature {#requestops-signature}

```typescript
export declare function requestOps(get: (from: number, to: number, telemetryProps: ITelemetryProperties) => Promise<IDeltasFetchResult>, concurrency: number, fromTotal: number, toTotal: number | undefined, payloadSize: number, logger: ITelemetryLoggerExt, signal?: AbortSignal, scenarioName?: string): IStream<ISequencedDocumentMessage[]>;
```

#### Parameters {#requestops-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        get
      </td>
      <td>
      </td>
      <td>
        <span>(from: number, to: number, telemetryProps: ITelemetryProperties) =&gt; Promise&lt;<a href='/docs/apis/driver-definitions/ideltasfetchresult-interface'>IDeltasFetchResult</a>&gt;</span>
      </td>
      <td>
        Getter callback to get individual batches
      </td>
    </tr>
    <tr>
      <td>
        concurrency
      </td>
      <td>
      </td>
      <td>
        <span>number</span>
      </td>
      <td>
        Number of concurrent requests to make
      </td>
    </tr>
    <tr>
      <td>
        fromTotal
      </td>
      <td>
      </td>
      <td>
        <span>number</span>
      </td>
      <td>
        starting sequence number to fetch (inclusive)
      </td>
    </tr>
    <tr>
      <td>
        toTotal
      </td>
      <td>
      </td>
      <td>
        <span>number &#124; undefined</span>
      </td>
      <td>
        max (exclusive) sequence number to fetch
      </td>
    </tr>
    <tr>
      <td>
        payloadSize
      </td>
      <td>
      </td>
      <td>
        <span>number</span>
      </td>
      <td>
        Payload size
      </td>
    </tr>
    <tr>
      <td>
        logger
      </td>
      <td>
      </td>
      <td>
        <span><a href='/docs/apis/telemetry-utils/itelemetryloggerext-interface'>ITelemetryLoggerExt</a></span>
      </td>
      <td>
        Logger to log progress and errors
      </td>
    </tr>
    <tr>
      <td>
        signal
      </td>
      <td>
        optional
      </td>
      <td>
        <span>AbortSignal</span>
      </td>
      <td>
        Cancelation signal
      </td>
    </tr>
    <tr>
      <td>
        scenarioName
      </td>
      <td>
        optional
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        Reason for fetching ops
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#requestops-returns}

- Messages fetched

**Return type:** [IStream](/docs/apis/driver-definitions/istream-interface)&lt;[ISequencedDocumentMessage](/docs/apis/protocol-definitions/isequenceddocumentmessage-interface)\[\]&gt;

### runWithRetry {#runwithretry-function}

#### Signature {#runwithretry-signature}

```typescript
export declare function runWithRetry<T>(api: (cancel?: AbortSignal) => Promise<T>, fetchCallName: string, logger: ITelemetryLoggerExt, progress: IProgress): Promise<T>;
```

#### Parameters {#runwithretry-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        api
      </td>
      <td>
        <span>(cancel?: AbortSignal) =&gt; Promise&lt;T&gt;</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        fetchCallName
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        logger
      </td>
      <td>
        <span><a href='/docs/apis/telemetry-utils/itelemetryloggerext-interface'>ITelemetryLoggerExt</a></span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        progress
      </td>
      <td>
        <span><a href='/docs/apis/driver-utils/iprogress-interface'>IProgress</a></span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#runwithretry-returns}

**Return type:** Promise&lt;T&gt;

### streamFromMessages {#streamfrommessages-function}

#### Signature {#streamfrommessages-signature}

```typescript
export declare function streamFromMessages(messagesArg: Promise<ISequencedDocumentMessage[]>): IStream<ISequencedDocumentMessage[]>;
```

#### Parameters {#streamfrommessages-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        messagesArg
      </td>
      <td>
        <span>Promise&lt;<a href='/docs/apis/protocol-definitions/isequenceddocumentmessage-interface'>ISequencedDocumentMessage</a>[]&gt;</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#streamfrommessages-returns}

**Return type:** [IStream](/docs/apis/driver-definitions/istream-interface)&lt;[ISequencedDocumentMessage](/docs/apis/protocol-definitions/isequenceddocumentmessage-interface)\[\]&gt;

### streamObserver {#streamobserver-function}

#### Signature {#streamobserver-signature}

```typescript
export declare function streamObserver<T>(stream: IStream<T>, handler: (value: IStreamResult<T>) => void): IStream<T>;
```

#### Parameters {#streamobserver-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        stream
      </td>
      <td>
        <span><a href='/docs/apis/driver-definitions/istream-interface'>IStream</a>&lt;T&gt;</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        handler
      </td>
      <td>
        <span>(value: <a href='/docs/apis/driver-definitions#istreamresult-typealias'>IStreamResult</a>&lt;T&gt;) =&gt; void</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#streamobserver-returns}

**Return type:** [IStream](/docs/apis/driver-definitions/istream-interface)&lt;T&gt;

## Variable Details

### blobHeadersBlobName {#blobheadersblobname-variable}

#### Signature {#blobheadersblobname-signature}

```typescript
blobHeadersBlobName = ".metadata.blobHeaders"
```

### canRetryOnError {#canretryonerror-variable}

Check if a connection error can be retried. Unless explicitly allowed, retry is disallowed. I.e. asserts or unexpected exceptions in our code result in container failure.

#### Signature {#canretryonerror-signature}

```typescript
canRetryOnError: (error: any) => boolean
```

### createWriteError {#createwriteerror-variable}

#### Signature {#createwriteerror-signature}

```typescript
createWriteError: (message: string, props: DriverErrorTelemetryProps) => NonRetryableError<DriverErrorType.writeError>
```

### emptyMessageStream {#emptymessagestream-variable}

#### Signature {#emptymessagestream-signature}

```typescript
emptyMessageStream: IStream<ISequencedDocumentMessage[]>
```

### getRetryDelayFromError {#getretrydelayfromerror-variable}

Check retryAfterSeconds property on error and convert to ms

#### Signature {#getretrydelayfromerror-signature}

```typescript
getRetryDelayFromError: (error: any) => number | undefined
```

### getRetryDelaySecondsFromError {#getretrydelaysecondsfromerror-variable}

Check retryAfterSeconds property on error

#### Signature {#getretrydelaysecondsfromerror-signature}

```typescript
getRetryDelaySecondsFromError: (error: any) => number | undefined
```
