{
  "title": "Policy Class",
  "summary": "The policy followed by a [TransactionInternal](/docs/apis/tree/transactioninternal-namespace).",
  "kind": "Class",
  "members": {
    "Method": {
      "createViewNodesForTree": "/docs/apis/tree/transactioninternal/policy-class#createviewnodesfortree-method",
      "dispatchChange": "/docs/apis/tree/transactioninternal/policy-class#dispatchchange-method",
      "tryResolveChange": "/docs/apis/tree/transactioninternal/policy-class#tryresolvechange-method",
      "validateOnClose": "/docs/apis/tree/transactioninternal/policy-class#validateonclose-method"
    },
    "Property": {
      "detached": "/docs/apis/tree/transactioninternal/policy-class#detached-property"
    }
  },
  "package": "@fluid-experimental/tree",
  "unscopedPackageName": "tree"
}

[//]: # (Do not edit this file. It is automatically generated by @fluidtools/api-markdown-documenter.)

[Packages](/docs/apis/) &gt; [@fluid-experimental/tree](/docs/apis/tree) &gt; [TransactionInternal](/docs/apis/tree/transactioninternal-namespace) &gt; [Policy](/docs/apis/tree/transactioninternal/policy-class)

The policy followed by a [TransactionInternal](/docs/apis/tree/transactioninternal-namespace).

## Signature {#policy-signature}

```typescript
export class Policy implements GenericTransactionPolicy
```

**Implements:** [GenericTransactionPolicy](/docs/apis/tree/generictransactionpolicy-interface)

## Properties

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Property
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/tree/transactioninternal/policy-class#detached-property'>detached</a>
      </td>
      <td>
        <code>readonly</code>
      </td>
      <td>
        <span>Map&lt;<a href='/docs/apis/tree#detachedsequenceid-typealias'>DetachedSequenceId</a>, readonly <a href='/docs/apis/tree#nodeid-typealias'>NodeId</a>[]&gt;</span>
      </td>
      <td>
        Maps detached sequences of nodes to their NodeIds
      </td>
    </tr>
  </tbody>
</table>

## Methods

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Method
      </th>
      <th>
        Return Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/tree/transactioninternal/policy-class#createviewnodesfortree-method'>createViewNodesForTree</a>
      </td>
      <td>
        <span><a href='/docs/apis/tree#nodeid-typealias'>NodeId</a>[] &#124; undefined</span>
      </td>
      <td>
        Generates tree view nodes from the supplied edit nodes. Invokes onCreateNode for each new node, and halts creation early if it returns true. Invokes onInvalidDetachedId and halts early for any invalid detached IDs referenced in the edit node sequence.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/transactioninternal/policy-class#dispatchchange-method'>dispatchChange</a>
      </td>
      <td>
        <span><a href='/docs/apis/tree#changeresult-typealias'>ChangeResult</a></span>
      </td>
      <td>
        Applies a given change
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/transactioninternal/policy-class#tryresolvechange-method'>tryResolveChange</a>
      </td>
      <td>
        <span><a href='/docs/apis/tree/result/ok-interface'>Result.Ok</a>&lt;<a href='/docs/apis/tree#changeinternal-typealias'>ChangeInternal</a>&gt;</span>
      </td>
      <td>
        Resolves change with Result.Ok
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/transactioninternal/policy-class#validateonclose-method'>validateOnClose</a>
      </td>
      <td>
        <span><a href='/docs/apis/tree#changeresult-typealias'>ChangeResult</a></span>
      </td>
      <td>
        Validates the transaction when it is closed
      </td>
    </tr>
  </tbody>
</table>

## Property Details

### detached {#detached-property}

Maps detached sequences of nodes to their NodeIds

#### Signature {#detached-signature}

```typescript
protected readonly detached: Map<DetachedSequenceId, readonly NodeId[]>;
```

## Method Details

### createViewNodesForTree {#createviewnodesfortree-method}

Generates tree view nodes from the supplied edit nodes. Invokes onCreateNode for each new node, and halts creation early if it returns true. Invokes onInvalidDetachedId and halts early for any invalid detached IDs referenced in the edit node sequence.

#### Signature {#createviewnodesfortree-signature}

```typescript
protected createViewNodesForTree(sequence: Iterable<BuildNodeInternal>, onCreateNode: (stableId: NodeId, node: TreeViewNode) => boolean, onInvalidDetachedId: (sequenceId: DetachedSequenceId) => void): NodeId[] | undefined;
```

#### Parameters {#createviewnodesfortree-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        sequence
      </td>
      <td>
        <span>Iterable&lt;<a href='/docs/apis/tree#buildnodeinternal-typealias'>BuildNodeInternal</a>&gt;</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        onCreateNode
      </td>
      <td>
        <span>(stableId: <a href='/docs/apis/tree#nodeid-typealias'>NodeId</a>, node: <a href='/docs/apis/tree/treeviewnode-interface'>TreeViewNode</a>) =&gt; boolean</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        onInvalidDetachedId
      </td>
      <td>
        <span>(sequenceId: <a href='/docs/apis/tree#detachedsequenceid-typealias'>DetachedSequenceId</a>) =&gt; void</span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#createviewnodesfortree-returns}

all the top-level node IDs in `sequence` (both from nodes and from detached sequences).

**Return type:** [NodeId](/docs/apis/tree#nodeid-typealias)\[\] \| undefined

### dispatchChange {#dispatchchange-method}

Applies a given change

#### Signature {#dispatchchange-signature}

```typescript
dispatchChange(state: ValidState, change: ChangeInternal): ChangeResult;
```

#### Parameters {#dispatchchange-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        state
      </td>
      <td>
        <span>ValidState</span>
      </td>
      <td>
        Current state
      </td>
    </tr>
    <tr>
      <td>
        change
      </td>
      <td>
        <span><a href='/docs/apis/tree#changeinternal-typealias'>ChangeInternal</a></span>
      </td>
      <td>
        Change to apply
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#dispatchchange-returns}

a [ChangeResult](/docs/apis/tree#changeresult-typealias) containing either the change result or a Failure

**Return type:** [ChangeResult](/docs/apis/tree#changeresult-typealias)

### tryResolveChange {#tryresolvechange-method}

Resolves change with Result.Ok

#### Signature {#tryresolvechange-signature}

```typescript
tryResolveChange(state: ValidState, change: ChangeInternal): Result.Ok<ChangeInternal>;
```

#### Parameters {#tryresolvechange-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        state
      </td>
      <td>
        <span>ValidState</span>
      </td>
      <td>
        Unused
      </td>
    </tr>
    <tr>
      <td>
        change
      </td>
      <td>
        <span><a href='/docs/apis/tree#changeinternal-typealias'>ChangeInternal</a></span>
      </td>
      <td>
        Change to resolve
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#tryresolvechange-returns}

Result.Ok which contains change

**Return type:** [Result.Ok](/docs/apis/tree/result/ok-interface)&lt;[ChangeInternal](/docs/apis/tree#changeinternal-typealias)&gt;

### validateOnClose {#validateonclose-method}

Validates the transaction when it is closed

#### Signature {#validateonclose-signature}

```typescript
validateOnClose(state: ValidState): ChangeResult;
```

#### Parameters {#validateonclose-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        state
      </td>
      <td>
        <span>ValidState</span>
      </td>
      <td>
        Current state
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#validateonclose-returns}

a [ChangeResult](/docs/apis/tree#changeresult-typealias) containing either the change result or a Failure

**Return type:** [ChangeResult](/docs/apis/tree#changeresult-typealias)
