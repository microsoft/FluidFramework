{
  "title": "PactMap Class",
  "summary": "The PactMap distributed data structure provides key/value storage with a cautious conflict resolution strategy. This strategy optimizes for all clients being aware of the change prior to considering the value as accepted.\n\nIt is still experimental and under development. Please do try it out, but expect breaking changes in the future.",
  "kind": "Class",
  "members": {
    "Constructor": {
      "(constructor)": "/docs/apis/pact-map/pactmap-class#_constructor_-constructor"
    },
    "Method": {
      "applyStashedOp": "/docs/apis/pact-map/pactmap-class#applystashedop-method",
      "create": "/docs/apis/pact-map/pactmap-class#create-method",
      "delete": "/docs/apis/pact-map/pactmap-class#delete-method",
      "get": "/docs/apis/pact-map/pactmap-class#get-method",
      "getFactory": "/docs/apis/pact-map/pactmap-class#getfactory-method",
      "getPending": "/docs/apis/pact-map/pactmap-class#getpending-method",
      "getWithDetails": "/docs/apis/pact-map/pactmap-class#getwithdetails-method",
      "isPending": "/docs/apis/pact-map/pactmap-class#ispending-method",
      "set": "/docs/apis/pact-map/pactmap-class#set-method"
    }
  },
  "package": "@fluid-experimental/pact-map",
  "unscopedPackageName": "pact-map"
}

[//]: # (Do not edit this file. It is automatically generated by @fluidtools/api-markdown-documenter.)

[Packages](/docs/apis/) &gt; [@fluid-experimental/pact-map](/docs/apis/pact-map) &gt; [PactMap](/docs/apis/pact-map/pactmap-class)

The PactMap distributed data structure provides key/value storage with a cautious conflict resolution strategy. This strategy optimizes for all clients being aware of the change prior to considering the value as accepted.

It is still experimental and under development. Please do try it out, but expect breaking changes in the future.

## Signature {#pactmap-signature}

```typescript
export declare class PactMap<T = unknown> extends SharedObject<IPactMapEvents> implements IPactMap<T>
```

**Extends:** [SharedObject](/docs/apis/shared-object-base/sharedobject-class)&lt;[IPactMapEvents](/docs/apis/pact-map/ipactmapevents-interface)&gt;

**Implements:** [IPactMap](/docs/apis/pact-map/ipactmap-interface)&lt;T&gt;

### Type Parameters

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        T
      </td>
      <td>
        optional
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

## Remarks {#pactmap-remarks}

\#\#\# Creation

To create a `PactMap`, call the static create method:

```typescript
const pactMap = PactMap.create(this.runtime, id);
```

\#\#\# Usage

Setting and reading values is somewhat similar to a `SharedMap`. However, because the acceptance strategy cannot be resolved until other clients have witnessed the set, the new value will only be reflected in the data after the consensus is reached.

```typescript
pactMap.on("pending", (key: string) => {
    console.log(pactMap.getPending(key));
});
pactMap.on("accepted", (key: string) => {
    console.log(pactMap.get(key));
});
pactMap.set("myKey", "myValue");
// Reading from the pact map prior to the async operation's completion will still return the old value.
console.log(pactMap.get("myKey"));
```

The acceptance process has two stages. When an op indicating a client's attempt to set a value is sequenced, we first verify that it was set with knowledge of the most recently accepted value (consensus-like FWW). If it meets this bar, then the value is "pending". During this time, clients may observe the pending value and act upon it, but should be aware that not all other clients may have witnessed the value yet. Once all clients that were connected at the time of the value being set have explicitly acknowledged the new value, the value becomes "accepted". Once the value is accepted, it once again becomes possible to set the value, again with consensus-like FWW resolution.

Since all connected clients must explicitly accept the new value, it is important that all connected clients have the PactMap loaded, including e.g. the summarizing client. Otherwise, those clients who have not loaded the PactMap will not be responding to proposals and delay their acceptance (until they disconnect, which implicitly removes them from consideration). The easiest way to ensure all clients load the PactMap is to instantiate it as part of instantiating the IRuntime for the container (containerHasInitialized if using Aqueduct).

\#\#\# Eventing

`PactMap` is an `EventEmitter`, and will emit events when a new value is accepted for a key.

```typescript
pactMap.on("accept", (key: string) => {
    console.log(`New value was accepted for key: ${ key }, value: ${ pactMap.get(key) }`);
});
```

## Constructors

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Constructor
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#_constructor_-constructor'>(constructor)</a>
      </td>
      <td>
        Constructs a new PactMap. If the object is non-local an id and service interfaces will be provided
      </td>
    </tr>
  </tbody>
</table>

## Static Methods

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Method
      </th>
      <th>
        Return Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#create-method'>create</a>
      </td>
      <td>
        <span><a href='/docs/apis/pact-map/pactmap-class'>PactMap</a></span>
      </td>
      <td>
        Create a new PactMap
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#getfactory-method'>getFactory</a>
      </td>
      <td>
        <span><a href='/docs/apis/datastore-definitions/ichannelfactory-interface'>IChannelFactory</a></span>
      </td>
      <td>
        Get a factory for PactMap to register with the data store.
      </td>
    </tr>
  </tbody>
</table>

## Methods

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Method
      </th>
      <th>
        Return Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#applystashedop-method'>applyStashedOp</a>
      </td>
      <td>
        <span>void</span>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#delete-method'>delete</a>
      </td>
      <td>
        <span>void</span>
      </td>
      <td>
        Deletes the key/value pair at the given key. After issuing the delete, the delete is in &quot;pending&quot; state until all connected clients have approved the delete. The accepted value remains unchanged until that time.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#get-method'>get</a>
      </td>
      <td>
        <span>T &#124; undefined</span>
      </td>
      <td>
        Gets the accepted value for the given key.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#getpending-method'>getPending</a>
      </td>
      <td>
        <span>T &#124; undefined</span>
      </td>
      <td>
        Gets the pending value for the given key.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#getwithdetails-method'>getWithDetails</a>
      </td>
      <td>
        <span><a href='/docs/apis/pact-map/iacceptedpact-interface'>IAcceptedPact</a>&lt;T&gt; &#124; undefined</span>
      </td>
      <td>
        Gets the accepted value and details for the given key.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#ispending-method'>isPending</a>
      </td>
      <td>
        <span>boolean</span>
      </td>
      <td>
        Returns whether there is a pending value for the given key. Can be used to distinguish a pending delete vs. nothing pending when getPending would just return undefined.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/pact-map/pactmap-class#set-method'>set</a>
      </td>
      <td>
        <span>void</span>
      </td>
      <td>
        Sets the value for the given key. After setting the value, it will be in &quot;pending&quot; state until all connected clients have approved the change. The accepted value remains unchanged until that time.
      </td>
    </tr>
  </tbody>
</table>

## Constructor Details

### (constructor) {#_constructor_-constructor}

Constructs a new PactMap. If the object is non-local an id and service interfaces will be provided

#### Signature {#_constructor_-signature}

```typescript
constructor(id: string, runtime: IFluidDataStoreRuntime, attributes: IChannelAttributes);
```

#### Parameters {#_constructor_-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        id
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        optional name of the PactMap
      </td>
    </tr>
    <tr>
      <td>
        runtime
      </td>
      <td>
        <span><a href='/docs/apis/datastore-definitions/ifluiddatastoreruntime-interface'>IFluidDataStoreRuntime</a></span>
      </td>
      <td>
        data store runtime the PactMap belongs to
      </td>
    </tr>
    <tr>
      <td>
        attributes
      </td>
      <td>
        <span><a href='/docs/apis/datastore-definitions/ichannelattributes-interface'>IChannelAttributes</a></span>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

## Method Details

### applyStashedOp {#applystashedop-method}

#### Signature {#applystashedop-signature}

```typescript
applyStashedOp(): void;
```

### create {#create-method}

Create a new PactMap

#### Signature {#create-signature}

```typescript
static create(runtime: IFluidDataStoreRuntime, id?: string): PactMap;
```

#### Parameters {#create-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Modifiers
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        runtime
      </td>
      <td>
      </td>
      <td>
        <span><a href='/docs/apis/datastore-definitions/ifluiddatastoreruntime-interface'>IFluidDataStoreRuntime</a></span>
      </td>
      <td>
        data store runtime the new PactMap belongs to
      </td>
    </tr>
    <tr>
      <td>
        id
      </td>
      <td>
        optional
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        optional name of the PactMap
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#create-returns}

newly created PactMap (but not attached yet)

**Return type:** [PactMap](/docs/apis/pact-map/pactmap-class)

### delete {#delete-method}

Deletes the key/value pair at the given key. After issuing the delete, the delete is in "pending" state until all connected clients have approved the delete. The accepted value remains unchanged until that time.

#### Signature {#delete-signature}

```typescript
delete(key: string): void;
```

#### Parameters {#delete-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        the key to delete
      </td>
    </tr>
  </tbody>
</table>

### get {#get-method}

Gets the accepted value for the given key.

#### Signature {#get-signature}

```typescript
get(key: string): T | undefined;
```

#### Parameters {#get-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The key to retrieve from
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#get-returns}

**Return type:** T \| undefined

### getFactory {#getfactory-method}

Get a factory for PactMap to register with the data store.

#### Signature {#getfactory-signature}

```typescript
static getFactory(): IChannelFactory;
```

#### Returns {#getfactory-returns}

a factory that creates and loads PactMaps

**Return type:** [IChannelFactory](/docs/apis/datastore-definitions/ichannelfactory-interface)

### getPending {#getpending-method}

Gets the pending value for the given key.

#### Signature {#getpending-signature}

```typescript
getPending(key: string): T | undefined;
```

#### Parameters {#getpending-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The key to retrieve from
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#getpending-returns}

**Return type:** T \| undefined

### getWithDetails {#getwithdetails-method}

Gets the accepted value and details for the given key.

#### Signature {#getwithdetails-signature}

```typescript
getWithDetails(key: string): IAcceptedPact<T> | undefined;
```

#### Parameters {#getwithdetails-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The key to retrieve from
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#getwithdetails-returns}

**Return type:** [IAcceptedPact](/docs/apis/pact-map/iacceptedpact-interface)&lt;T&gt; \| undefined

### isPending {#ispending-method}

Returns whether there is a pending value for the given key. Can be used to distinguish a pending delete vs. nothing pending when getPending would just return undefined.

#### Signature {#ispending-signature}

```typescript
isPending(key: string): boolean;
```

#### Parameters {#ispending-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The key to check
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#ispending-returns}

**Return type:** boolean

### set {#set-method}

Sets the value for the given key. After setting the value, it will be in "pending" state until all connected clients have approved the change. The accepted value remains unchanged until that time.

#### Signature {#set-signature}

```typescript
set(key: string, value: T | undefined): void;
```

#### Parameters {#set-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>
        Parameter
      </th>
      <th>
        Type
      </th>
      <th>
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <span>string</span>
      </td>
      <td>
        The key to set
      </td>
    </tr>
    <tr>
      <td>
        value
      </td>
      <td>
        <span>T &#124; undefined</span>
      </td>
      <td>
        The value to store
      </td>
    </tr>
  </tbody>
</table>
